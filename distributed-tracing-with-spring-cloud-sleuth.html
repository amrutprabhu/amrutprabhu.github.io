<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/icon.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/icon.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('light');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="amrutprabhu" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18" strategy="afterInteractive" async=""></script><title>Distributed Tracing with Spring Cloud Sleuth And Zipkin | RefactorFirst</title><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7490174059724719" crossorigin="anonymous"></script><meta name="robots" content="follow, index"/><meta name="description" content="We would learn how we can implement distributed tracing in a Spring Boot Application and understand the key concepts of distributed tracing"/><meta property="og:url" content="https://refactorfirst.com/distributed-tracing-with-spring-cloud-sleuth"/><meta property="og:type" content="article"/><meta property="og:site_name" content="RefactorFirst"/><meta property="og:description" content="We would learn how we can implement distributed tracing in a Spring Boot Application and understand the key concepts of distributed tracing"/><meta property="og:title" content="Distributed Tracing with Spring Cloud Sleuth And Zipkin"/><meta property="og:image" content="https://refactorfirst.com/static/images/2021/distributed-tracing-with-zipkin/cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/amrutprabhu42"/><meta name="twitter:title" content="Distributed Tracing with Spring Cloud Sleuth And Zipkin"/><meta name="twitter:description" content="We would learn how we can implement distributed tracing in a Spring Boot Application and understand the key concepts of distributed tracing"/><meta name="twitter:image" content="https://refactorfirst.com/static/images/2021/distributed-tracing-with-zipkin/cover.jpg"/><meta property="article:published_time" content="2021-08-19T00:00:00.000Z"/><link rel="canonical" href="https://refactorfirst.com/distributed-tracing-with-spring-cloud-sleuth"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://refactorfirst.com/2021/distributed-tracing-with-spring-cloud-sleuth"
  },
  "headline": "Distributed Tracing with Spring Cloud Sleuth And Zipkin",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://refactorfirst.com/static/images/2021/distributed-tracing-with-zipkin/cover.jpg"
    }
  ],
  "datePublished": "2021-08-19T00:00:00.000Z",
  "dateModified": "2021-08-19T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Amrut Prabhu"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Amrut Prabhu",
    "logo": {
      "@type": "ImageObject",
      "url": "https://refactorfirst.com/static/images/favicons/icon.png"
    }
  },
  "description": "We would learn how we can implement distributed tracing in a Spring Boot Application and understand the key concepts of distributed tracing"
}</script><meta name="next-head-count" content="22"/><link rel="preload" href="/_next/static/css/7f0b93ff5935c0b4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7f0b93ff5935c0b4.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-525b8022646f7725.js" defer=""></script><script src="/_next/static/chunks/main-a8532ea7c2505ecc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-115c3eb9acb4de97.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/207-4f91422181f853c0.js" defer=""></script><script src="/_next/static/chunks/102-e5a1ee3ecda45278.js" defer=""></script><script src="/_next/static/chunks/883-e8957dac410dc24a.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-da416b81bf0ecd48.js" defer=""></script><script src="/_next/static/onNiRdjbaCBBK8GjKpe72/_buildManifest.js" defer=""></script><script src="/_next/static/onNiRdjbaCBBK8GjKpe72/_ssgManifest.js" defer=""></script><script src="/_next/static/onNiRdjbaCBBK8GjKpe72/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-6xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="RefactorFirst" href="/"><div class="flex items-center justify-between"><div class="mr-3"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img srcSet="/static/favicons/icon.png?imwidth=64 1x, /static/favicons/icon.png?imwidth=128 2x" src="/static/favicons/icon.png?imwidth=128" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><div class="h-6 text-2xl font-semibold sm:block">RefactorFirst</div></div></a></div><div class="mt-6"></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/posts">Posts</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/posts">Posts</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-6xl xl:px-0"><div class="fixed flex-col hidden gap-3 right-8 bottom-8 md:flex"><button aria-label="Scroll To Top" type="button" style="opacity:0" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2021-08-19T00:00:00.000Z">Thursday, August 19, 2021</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Distributed Tracing with Spring Cloud Sleuth And Zipkin</h1><div class="mt-6"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzQ0IiBoZWlnaHQ9IjQwNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Distributed Tracing with Spring Cloud Sleuth And Zipkin" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="object-cover object-center lg:h-48 md:h-36" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Distributed Tracing with Spring Cloud Sleuth And Zipkin" srcSet="static/images/2021/distributed-tracing-with-zipkin/cover.jpg?imwidth=750 1x, static/images/2021/distributed-tracing-with-zipkin/cover.jpg?imwidth=1920 2x" src="static/images/2021/distributed-tracing-with-zipkin/cover.jpg?imwidth=1920" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="object-cover object-center lg:h-48 md:h-36" loading="lazy"/></noscript></span></div><div class="text-primary-500 hover:text-primary-600 text-md dark:hover:text-primary-400"><a target="_blank" rel="noopener noreferrer" href="https://unsplash.com/photos/d9ILr-dbEdg"> Photo Credits</a></div><div class="mt-2 text-gray-500 dark:text-gray-400">8 min read</div></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="w-10 h-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="static/images/avatar-small.jpg?imwidth=48 1x, static/images/avatar-small.jpg?imwidth=96 2x" src="static/images/avatar-small.jpg?imwidth=96" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="w-10 h-10 rounded-full" loading="lazy"/></noscript></span><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Amrut Prabhu</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/amrutprabhu42" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@amrutprabhu42</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose text-md dark:prose-dark max-w-none"><div></div><div><p>In this article, we would learn how we can implement distributed tracing and understand the key concepts of distributed tracing.</p>
<h1 id="introduction"><a href="#introduction" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Introduction</h1>
<p>In the case of a single giant application that does everything which we usually refer to as a monolith, tracing the incoming request within the application was easy. We could follow the logs and then figure out how the request was being handled. There was nothing else we would have to look at but the application logs themselves.</p>
<p>Over time, monoliths become difficult to scale, to serve a large number of requests as well as delivering new features to the customer with the growing size of the codebase. This leads to breaking down the monolith into microservice which helps in scaling individual components and also helps to deliver faster.</p>
<p>But not all that shines is gold, right? It&#x27;s the same thing with microservices. We split the entire monolith system into microservices and every request that was processed by a set of local function calls is now replaced by calling a set of distributed services. With this, we lose things like tracing a request that was easily done in a monolith. Now to trace each request we would have to look at the logs of each service and it becomes difficult to correlate.</p>
<p>So in the case of distributed systems, the concept of distributed tracing helps with tracing a request.</p>
<h1 id="what-is-distributed-tracing"><a href="#what-is-distributed-tracing" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What is Distributed Tracing?</h1>
<p>Distributed tracing is a mechanism with which we can trace a particular request throughout a distributed system. It allows us to track how a request progresses from one system to another thereby completing the user’s request.</p>
<h1 id="key-concepts-of-distributed-tracing"><a href="#key-concepts-of-distributed-tracing" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Key concepts of Distributed Tracing.</h1>
<p>Distributed tracing consists of two main concepts</p>
<ul>
<li>Trace Id</li>
<li>Span Id</li>
</ul>
<p>Trace Id is used to trace an incoming request and track it across all the composing services to satisfy a request.</p>
<p>Span Id is more of spans in between service calls to track each request that is received and to the response that is sent out.</p>
<p>let&#x27;s have a look at the diagram.</p>
<div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzM1IiBoZWlnaHQ9IjM2MiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="distributed-tracing diagram" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="distributed-tracing diagram" srcSet="static/images/2021/distributed-tracing-with-zipkin/distributed-tracing-diagram.png?imwidth=750 1x, static/images/2021/distributed-tracing-with-zipkin/distributed-tracing-diagram.png?imwidth=1920 2x" src="static/images/2021/distributed-tracing-with-zipkin/distributed-tracing-diagram.png?imwidth=1920" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div>
<p>The incoming request doesn’t have any Trace id, the first service intercepting the call generates the trace id “ID1” and its span id “A”. The span id “B” covers the time from when the client at server 1 sent out the request, then server 2 receiving it, processing it, and sending out the response.</p>
<p>With the concepts understood, let’s now do this practically and understand more inside details.</p>
<h1 id="spring-boot-example-with-spring-cloud-sleuth"><a href="#spring-boot-example-with-spring-cloud-sleuth" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Spring Boot Example With Spring Cloud Sleuth</h1>
<p>Let’s create an application with spring cloud sleuth integrated. To start, let&#x27;s go to <a target="_blank" rel="noopener noreferrer" href="https://start.spring.io/">https://start.spring.io/</a> and create an application with the dependencies “Spring Web” and “Spring Cloud Sleuth”.</p>
<p>Now let’s create a simple controller with two request mapping.</p>
<div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line"> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"> <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"> <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.application.name}&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"> <span class="token keyword">private</span> <span class="token class-name">String</span> applicationName<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"> <span class="token keyword">public</span> <span class="token class-name">Controller</span><span class="token punctuation">(</span><span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate <span class="token operator">=</span> restTemplate<span class="token punctuation">;</span>
</span><span class="code-line"> <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"> <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/path1&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"> <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span> <span class="token function">path1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Request at {} for request /path1 &quot;</span><span class="token punctuation">,</span> applicationName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token class-name">String</span> response <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8090/service/path2&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;response from /path1 + &quot;</span><span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"> <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/path2&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span> <span class="token function">path2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
</span><span class="code-line">  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Request at {} at /path2&quot;</span><span class="token punctuation">,</span> applicationName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;response from /path2 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div>
<p>Here I have created two paths, <code>Path1</code> calling <code>Path2</code> at a fixed port 8090. The idea here is to run two separate instances of the same application.</p>
<p>Now to allow sleuth to inject headers into the outgoing request, we need the RestTemplate to be injected as a bean rather than initializing it directly. This will allow sleuth to add an interceptor to the RestTemplate to inject a header with the trace id and span id into the outgoing request.</p>
<div class="relative"><pre><code class="language-java code-highlight"><span class="code-line"><span class="token annotation punctuation">@Bean</span>
</span><span class="code-line">   <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token class-name">RestTemplateBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">   <span class="token punctuation">}</span>
</span></code></pre></div>
<p>Now, let&#x27;s start the two instances. To do that, first, build the application with <code>mvn clean verify</code> and then run the following command to start “Service 1”</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">java -jar <span class="token punctuation">\</span>
</span><span class="code-line">target/Distributed-Service-0.0.1-SNAPSHOT.jar <span class="token punctuation">\</span>
</span><span class="code-line">--spring.application.name<span class="token operator">=</span>Service-1 <span class="token punctuation">\</span>
</span><span class="code-line">--server.port<span class="token operator">=</span><span class="token number">8080</span>
</span></code></pre></div>
<p>Then on a different terminal run “Service 2” as follows</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">java -jar <span class="token punctuation">\</span>
</span><span class="code-line">target/Distributed-Service-0.0.1-SNAPSHOT.jar <span class="token punctuation">\</span>
</span><span class="code-line">--spring.application.name<span class="token operator">=</span>Service-2 <span class="token punctuation">\</span>
</span><span class="code-line">--server.port<span class="token operator">=</span><span class="token number">8090</span>
</span></code></pre></div>
<p>Once the application starts, call “Service 1” at <code>/path1</code> as follows</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="token function">curl</span> -i http://localhost:8080/service/path1
</span></code></pre></div>
<p>Now let’s look at the logs of “Service 1”.</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">INFO <span class="token punctuation">[</span>Service-1,222f3b00a283c75c,222f3b00a283c75c<span class="token punctuation">]</span> <span class="token number">41114</span> --- <span class="token punctuation">[</span>nio-8080-exec-1<span class="token punctuation">]</span> c.a.p.distributedservice.Controller      <span class="token builtin class-name">:</span> Incoming request at Service-1 <span class="token keyword">for</span> request /path1
</span></code></pre></div>
<p>The log contains square brackets with three parts [ Service name, Trace Id, Span Id ]. For the first incoming request, since there is no incoming trace id, the span id is the same as the trace id.</p>
<p>Looking at the logs of “Service 2”, we see that we have a new span id for this request.</p>
<div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">INFO <span class="token punctuation">[</span>Service-2,222f3b00a283c75c,13194db963293a22<span class="token punctuation">]</span> <span class="token number">41052</span> --- <span class="token punctuation">[</span>nio-8090-exec-1<span class="token punctuation">]</span> c.a.p.distributedservice.Controller      <span class="token builtin class-name">:</span> Incoming request at Service-2 at /path2
</span></code></pre></div>
<p>I intercepted the request being sent out of “Service 1” to “Service 2” and found the following headers already present in the outgoing request.</p>
<div class="relative"><pre><code class="language-properties code-highlight"><span class="code-line"><span class="token attr-name">x-b3-traceid</span><span class="token punctuation">:</span><span class="token attr-value">&quot;222f3b00a283c75c&quot;</span>
</span><span class="code-line"><span class="token attr-name">x-b3-spanid</span><span class="token punctuation">:</span><span class="token attr-value">&quot;13194db963293a22&quot;</span>
</span><span class="code-line"><span class="token attr-name">x-b3-parentspanid</span><span class="token punctuation">:</span><span class="token attr-value">&quot;222f3b00a283c75c</span>
</span></code></pre></div>
<p>Here we see, the span for the next operation (call to “Service 2”) is already injected in the headers. These were injected by “Service 1” when the client was sending out the request. This means the span for the next call to “Service 2” is already started from the client of “Service 1”. In the headers shown above, The span id of “Service 1” is now the parent span id for the next span.</p>
<p>Now to make things easier to understand, we can visually see the traces using an interceptor tool called <a target="_blank" rel="noopener noreferrer" href="https://zipkin.io/">Zipkin</a>.</p>
<h3 id="visualizing-traces-with-zipkin"><a href="#visualizing-traces-with-zipkin" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Visualizing Traces with Zipkin</h3>
<p>To integrate <a target="_blank" rel="noopener noreferrer" href="https://zipkin.io/">Zipkin</a> with the application, we would need to add a Zipkin client dependency to the application.</p>
<div class="relative"><pre><code class="language-xml code-highlight"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-sleuth-zipkin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div>
<p>On adding this dependency, the Zipkin client by default sends the traces to the Zipkin server at port 9411.</p>
<p>let’s start the Zipkin server using its docker image. I created a simple docker-compose file for this.</p>
<div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#x27;3.1&#x27;</span>
</span><span class="code-line"><span class="token key atrule">services</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">zipkin</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> openzipkin/zipkin<span class="token punctuation">:</span><span class="token number">2</span>
</span><span class="code-line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token string">&#x27;9411:9411&#x27;</span>
</span></code></pre></div>
<p>We can now start the server using <code>docker-compose up</code> command. You can then access the UI at <code>http://localhost:9411/</code></p>
<p>Since we are using the default port, we don’t need to specify any properties, But if you plan to have a different port, you would need to add the following property.</p>
<div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">zipkin</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">baseUrl</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9411</span>
</span></code></pre></div>
<p>With this done, let&#x27;s start both the applications using the same commands from above.</p>
<p>On placing a request to “Service 1” at the path <code>/path1</code> we get the following traces.</p>
<div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTE0NiIgaGVpZ2h0PSIzNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img alt="Distributed tracing View" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Distributed tracing View" srcSet="static/images/2021/distributed-tracing-with-zipkin/distributed-trace-view.png?imwidth=1200 1x, static/images/2021/distributed-tracing-with-zipkin/distributed-trace-view.png?imwidth=3840 2x" src="static/images/2021/distributed-tracing-with-zipkin/distributed-trace-view.png?imwidth=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div>
<p>Here it shows the spans for the two services. We can dig deeper by looking at the spans.</p>
<p>The span for “Service 1” is a normal span covering from when it received the request to it returning a response.</p>
<p>The interesting one is the second span.</p>
<div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzY1IiBoZWlnaHQ9IjYyMyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Distributed trace 2" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Distributed trace 2" srcSet="static/images/2021/distributed-tracing-with-zipkin/distributed-trace-2.png?imwidth=828 1x, static/images/2021/distributed-tracing-with-zipkin/distributed-trace-2.png?imwidth=1920 2x" src="static/images/2021/distributed-tracing-with-zipkin/distributed-trace-2.png?imwidth=1920" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div>
<p>In this, there are 4 points in the span.</p>
<ul>
<li>The first point refers to when the client from “Service 1” started the request</li>
<li>The second point is when “Service 2” started processing the request.</li>
<li>The third point is when the client on “Server 1” finished receiving the response.</li>
<li>And finally, the last point when “Server 2” finished.</li>
</ul>
<div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzg2MyIgaGVpZ2h0PSIxODQ5IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="/></span><img alt="Tracing span details" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Tracing span details" srcSet="static/images/2021/distributed-tracing-with-zipkin/distributed-tracing-details.jpg?imwidth=3840 1x" src="static/images/2021/distributed-tracing-with-zipkin/distributed-tracing-details.jpg?imwidth=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div>
<h1 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion</h1>
<p>So with this, we have learned how we can integrate distributed tracing with spring cloud sleuth and also visualized the traces using Zipkin.</p>
<p>I have uploaded the code on <a target="_blank" rel="noopener noreferrer" href="https://github.com/amrutprabhu/distributed-tracing-with-spring-boot/tree/main/distributed-tracing-spring-cloud-sleuth-zipkin">GitHub</a>.</p>
<h2 id="youtube-video"><a href="#youtube-video" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>YouTube Video</h2>
<p>You can have a visual walk-through in the video below.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/m9a11SD8ITc" frameBorder="0" allowfullscreen=""></iframe></div></div><hr/></div><footer><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="m-1 p-1 leading-4 h-6 rounded text-xs uppercase text-white bg-teal-500 hover:bg-teal-600 dark:hover:bg-teal-500 dark:bg-teal-600" href="/tags/spring-boot">Spring Boot</a><a class="m-1 p-1 leading-4 h-6 rounded text-xs uppercase text-white bg-teal-500 hover:bg-teal-600 dark:hover:bg-teal-500 dark:bg-teal-600" href="/tags/java">Java</a><a class="m-1 p-1 leading-4 h-6 rounded text-xs uppercase text-white bg-teal-500 hover:bg-teal-600 dark:hover:bg-teal-500 dark:bg-teal-600" href="/tags/distributed-tracing">Distributed Tracing</a><a class="m-1 p-1 leading-4 h-6 rounded text-xs uppercase text-white bg-teal-500 hover:bg-teal-600 dark:hover:bg-teal-500 dark:bg-teal-600" href="/tags/zipkin">Zipkin</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/micronaut-aws-lambda-application-for-api-gateway">Micronaut JPA Application Performance on AWS Lambda</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/spring-cloud-gateway-keycloak-oauth2-openid-connect">Spring Cloud Gateway Keycloak OAuth2 OIDC Integration</a></div></div></div></div><div class="pt-4 xl:pt-8 xl:mb-8 mb-4"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/">← Back to the articles</a></div><div class="hidden xl:block"><div class="border-4 border-teal-500 rounded-lg p-1"><div><a target="_blank" rel="noopener noreferrer" href="https://www.copecart.com/products/521411d4/p/techapk42"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA1NCIgaGVpZ2h0PSIyMTAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="/></span><img alt="title" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="object-cover object-center " style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="title" srcSet="/static/images/promotion/testing-spring-boot-applications-masterclass-architecture-524x733.png?imwidth=1080 1x, /static/images/promotion/testing-spring-boot-applications-masterclass-architecture-524x733.png?imwidth=3840 2x" src="/static/images/promotion/testing-spring-boot-applications-masterclass-architecture-524x733.png?imwidth=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="object-cover object-center " loading="lazy"/></noscript></span></a></div></div></div><div class="adsbygoogle-ad3"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7490174059724719" data-ad-slot="8862054574" data-ad-format="auto" data-full-width-responsive="true" id="ad3"></ins></div><div class="adsbygoogle-ad4"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7490174059724719" data-ad-slot="6180491852" data-ad-format="auto" data-full-width-responsive="true" id="ad4"></ins></div></footer></div></div></article></div></main><div class="ml-form-embed" data-account="3117349:p5v1c3m1v8" data-form="4015126:i6h8m5"></div><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:contact@refactorfirst.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/amrutprabhu"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/amrut-prabhu-722baa65/"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/amrutprabhu42"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Amrut Prabhu</div><div> • </div><div>© 2023</div><div> • </div><a href="/">RefactorFirst</a><div> • </div><a href="/privacy">Privacy Policy</a></div><br/></div></footer></div></div><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-6xl xl:px-0"><div id="cookie-notice" class="consent_consentname__aF_O7"><br/><br/><p>By clicking “I Accept”, you agree to the storing of cookies on your device to enhance site navigation and analyze site usage</p><br/><br/><div><a id="cookie-notice-accept" class="consent_greenButton__K0FRN">I Accept</a><a href="/privacy">Privacy Policy</a></div><br/><br/><br/></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var c=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var l=a=\u003ec(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{l(a);for(var t in s)c(a,t,{get:s[t],enumerable:!0})},g=(a,s,t)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026c(a,n,{get:()=\u003es[n],enumerable:!(t=h(s,n))||t.enumerable});return a},w=a=\u003eg(l(c(a!=null?d(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=N((I,r)=\u003e{r.exports=_jsx_runtime});var S={};k(S,{default:()=\u003ev,frontmatter:()=\u003eb});var e=w(o()),b={title:\"Distributed Tracing with Spring Cloud Sleuth And Zipkin\",author:\"Amrut Prabhu\",tags:[\"Spring Boot\",\"Java\",\"Distributed Tracing\",\"Zipkin\"],\"photo-credits\":\"https://unsplash.com/photos/d9ILr-dbEdg\",\"applaud-link\":\"2021/distributed-tracing-with-spring-zipkin.json\",date:\"2021-08-19\",draft:!1,summary:\"We would learn how we can implement distributed tracing in a Spring Boot Application and understand the key concepts of distributed tracing\",imageUrl:\"/static/images/2021/distributed-tracing-with-zipkin/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({p:\"p\",h1:\"h1\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",div:\"div\",pre:\"pre\",code:\"code\",h3:\"h3\",h2:\"h2\"},a.components),{Image:i}=n;return i||y(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"In this article, we would learn how we can implement distributed tracing and understand the key concepts of distributed tracing.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"introduction\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#introduction\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In the case of a single giant application that does everything which we usually refer to as a monolith, tracing the incoming request within the application was easy. We could follow the logs and then figure out how the request was being handled. There was nothing else we would have to look at but the application logs themselves.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Over time, monoliths become difficult to scale, to serve a large number of requests as well as delivering new features to the customer with the growing size of the codebase. This leads to breaking down the monolith into microservice which helps in scaling individual components and also helps to deliver faster.\"}),`\n`,(0,e.jsx)(n.p,{children:\"But not all that shines is gold, right? It's the same thing with microservices. We split the entire monolith system into microservices and every request that was processed by a set of local function calls is now replaced by calling a set of distributed services. With this, we lose things like tracing a request that was easily done in a monolith. Now to trace each request we would have to look at the logs of each service and it becomes difficult to correlate.\"}),`\n`,(0,e.jsx)(n.p,{children:\"So in the case of distributed systems, the concept of distributed tracing helps with tracing a request.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"what-is-distributed-tracing\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#what-is-distributed-tracing\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What is Distributed Tracing?\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Distributed tracing is a mechanism with which we can trace a particular request throughout a distributed system. It allows us to track how a request progresses from one system to another thereby completing the user\\u2019s request.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"key-concepts-of-distributed-tracing\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#key-concepts-of-distributed-tracing\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Key concepts of Distributed Tracing.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Distributed tracing consists of two main concepts\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Trace Id\"}),`\n`,(0,e.jsx)(n.li,{children:\"Span Id\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Trace Id is used to trace an incoming request and track it across all the composing services to satisfy a request.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Span Id is more of spans in between service calls to track each request that is received and to the response that is sent out.\"}),`\n`,(0,e.jsx)(n.p,{children:\"let's have a look at the diagram.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"distributed-tracing diagram\",src:\"/static/images/2021/distributed-tracing-with-zipkin/distributed-tracing-diagram.png\",width:\"735\",height:\"362\"})}),`\n`,(0,e.jsx)(n.p,{children:\"The incoming request doesn\\u2019t have any Trace id, the first service intercepting the call generates the trace id \\u201CID1\\u201D and its span id \\u201CA\\u201D. The span id \\u201CB\\u201D covers the time from when the client at server 1 sent out the request, then server 2 receiving it, processing it, and sending out the response.\"}),`\n`,(0,e.jsx)(n.p,{children:\"With the concepts understood, let\\u2019s now do this practically and understand more inside details.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"spring-boot-example-with-spring-cloud-sleuth\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#spring-boot-example-with-spring-cloud-sleuth\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Spring Boot Example With Spring Cloud Sleuth\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Let\\u2019s create an application with spring cloud sleuth integrated. To start, let's go to \",(0,e.jsx)(n.a,{href:\"https://start.spring.io/\",children:\"https://start.spring.io/\"}),\" and create an application with the dependencies \\u201CSpring Web\\u201D and \\u201CSpring Cloud Sleuth\\u201D.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now let\\u2019s create a simple controller with two request mapping.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-java\",children:(0,e.jsxs)(n.code,{className:\"language-java code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Controller\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Logger\"}),\" logger \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"LoggerFactory\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getLogger\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Controller\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RestTemplate\"}),\" restTemplate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@Value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"${spring.application.name}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),\" applicationName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Controller\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RestTemplate\"}),\" restTemplate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"this\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"restTemplate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" restTemplate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@GetMapping\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"/path1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ResponseEntity\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"path1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  logger\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"info\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Request at {} for request /path1 \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" applicationName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),\" response \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" restTemplate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getForObject\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://localhost:8090/service/path2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ResponseEntity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"response from /path1 + \"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@GetMapping\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"/path2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ResponseEntity\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"path2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  logger\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"info\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Request at {} at /path2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" applicationName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ResponseEntity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"response from /path2 \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here I have created two paths, \",(0,e.jsx)(n.code,{children:\"Path1\"}),\" calling \",(0,e.jsx)(n.code,{children:\"Path2\"}),\" at a fixed port 8090. The idea here is to run two separate instances of the same application.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now to allow sleuth to inject headers into the outgoing request, we need the RestTemplate to be injected as a bean rather than initializing it directly. This will allow sleuth to add an interceptor to the RestTemplate to inject a header with the trace id and span id into the outgoing request.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-java\",children:(0,e.jsxs)(n.code,{className:\"language-java code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@Bean\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RestTemplate\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"restTemplate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RestTemplateBuilder\"}),\" builder\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" builder\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"build\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, let's start the two instances. To do that, first, build the application with \",(0,e.jsx)(n.code,{children:\"mvn clean verify\"}),\" and then run the following command to start \\u201CService 1\\u201D\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"java -jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"target/Distributed-Service-0.0.1-SNAPSHOT.jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--spring.application.name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"Service-1 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--server.port\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Then on a different terminal run \\u201CService 2\\u201D as follows\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"java -jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"target/Distributed-Service-0.0.1-SNAPSHOT.jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--spring.application.name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"Service-2 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--server.port\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8090\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Once the application starts, call \\u201CService 1\\u201D at \",(0,e.jsx)(n.code,{children:\"/path1\"}),\" as follows\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"language-shell code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),` -i http://localhost:8080/service/path1\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"Now let\\u2019s look at the logs of \\u201CService 1\\u201D.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"INFO \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Service-1,222f3b00a283c75c,222f3b00a283c75c\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"41114\"}),\" --- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"nio-8080-exec-1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" c.a.p.distributedservice.Controller      \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" Incoming request at Service-1 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` request /path1\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"The log contains square brackets with three parts [ Service name, Trace Id, Span Id ]. For the first incoming request, since there is no incoming trace id, the span id is the same as the trace id.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Looking at the logs of \\u201CService 2\\u201D, we see that we have a new span id for this request.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"INFO \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Service-2,222f3b00a283c75c,13194db963293a22\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"41052\"}),\" --- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"nio-8090-exec-1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" c.a.p.distributedservice.Controller      \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` Incoming request at Service-2 at /path2\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"I intercepted the request being sent out of \\u201CService 1\\u201D to \\u201CService 2\\u201D and found the following headers already present in the outgoing request.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-properties\",children:(0,e.jsxs)(n.code,{className:\"language-properties code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"x-b3-traceid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token attr-value\",children:'\"222f3b00a283c75c\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"x-b3-spanid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token attr-value\",children:'\"13194db963293a22\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"x-b3-parentspanid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token attr-value\",children:'\"222f3b00a283c75c'}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Here we see, the span for the next operation (call to \\u201CService 2\\u201D) is already injected in the headers. These were injected by \\u201CService 1\\u201D when the client was sending out the request. This means the span for the next call to \\u201CService 2\\u201D is already started from the client of \\u201CService 1\\u201D. In the headers shown above, The span id of \\u201CService 1\\u201D is now the parent span id for the next span.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now to make things easier to understand, we can visually see the traces using an interceptor tool called \",(0,e.jsx)(n.a,{href:\"https://zipkin.io/\",children:\"Zipkin\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"visualizing-traces-with-zipkin\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#visualizing-traces-with-zipkin\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Visualizing Traces with Zipkin\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"To integrate \",(0,e.jsx)(n.a,{href:\"https://zipkin.io/\",children:\"Zipkin\"}),\" with the application, we would need to add a Zipkin client dependency to the application.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-xml\",children:(0,e.jsxs)(n.code,{className:\"language-xml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"dependency\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"groupId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"org.springframework.cloud\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"groupId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"artifactId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"spring-cloud-sleuth-zipkin\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"artifactId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"dependency\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"On adding this dependency, the Zipkin client by default sends the traces to the Zipkin server at port 9411.\"}),`\n`,(0,e.jsx)(n.p,{children:\"let\\u2019s start the Zipkin server using its docker image. I created a simple docker-compose file for this.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"version\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'3.1'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"services\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"zipkin\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" openzipkin/zipkin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'9411:9411'\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We can now start the server using \",(0,e.jsx)(n.code,{children:\"docker-compose up\"}),\" command. You can then access the UI at \",(0,e.jsx)(n.code,{children:\"http://localhost:9411/\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"Since we are using the default port, we don\\u2019t need to specify any properties, But if you plan to have a different port, you would need to add the following property.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spring\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"zipkin\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"baseUrl\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//localhost\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"9411\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"With this done, let's start both the applications using the same commands from above.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"On placing a request to \\u201CService 1\\u201D at the path \",(0,e.jsx)(n.code,{children:\"/path1\"}),\" we get the following traces.\"]}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"Distributed tracing View\",src:\"/static/images/2021/distributed-tracing-with-zipkin/distributed-trace-view.png\",width:\"1146\",height:\"348\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Here it shows the spans for the two services. We can dig deeper by looking at the spans.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The span for \\u201CService 1\\u201D is a normal span covering from when it received the request to it returning a response.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The interesting one is the second span.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"Distributed trace 2\",src:\"/static/images/2021/distributed-tracing-with-zipkin/distributed-trace-2.png\",width:\"765\",height:\"623\"})}),`\n`,(0,e.jsx)(n.p,{children:\"In this, there are 4 points in the span.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"The first point refers to when the client from \\u201CService 1\\u201D started the request\"}),`\n`,(0,e.jsx)(n.li,{children:\"The second point is when \\u201CService 2\\u201D started processing the request.\"}),`\n`,(0,e.jsx)(n.li,{children:\"The third point is when the client on \\u201CServer 1\\u201D finished receiving the response.\"}),`\n`,(0,e.jsx)(n.li,{children:\"And finally, the last point when \\u201CServer 2\\u201D finished.\"}),`\n`]}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"Tracing span details\",src:\"/static/images/2021/distributed-tracing-with-zipkin/distributed-tracing-details.jpg\",width:\"3863\",height:\"1849\"})}),`\n`,(0,e.jsxs)(n.h1,{id:\"conclusion\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#conclusion\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,e.jsx)(n.p,{children:\"So with this, we have learned how we can integrate distributed tracing with spring cloud sleuth and also visualized the traces using Zipkin.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"I have uploaded the code on \",(0,e.jsx)(n.a,{href:\"https://github.com/amrutprabhu/distributed-tracing-with-spring-boot/tree/main/distributed-tracing-spring-cloud-sleuth-zipkin\",children:\"GitHub\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"youtube-video\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#youtube-video\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"YouTube Video\"]}),`\n`,(0,e.jsx)(n.p,{children:\"You can have a visual walk-through in the video below.\"}),`\n`,(0,e.jsx)(\"iframe\",{width:\"560\",height:\"315\",src:\"https://www.youtube.com/embed/m9a11SD8ITc\",frameBorder:\"0\",allowFullScreen:!0})]})}}var v=f;function y(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return S;})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":1},{"value":"What is Distributed Tracing?","url":"#what-is-distributed-tracing","depth":1},{"value":"Key concepts of Distributed Tracing.","url":"#key-concepts-of-distributed-tracing","depth":1},{"value":"Spring Boot Example With Spring Cloud Sleuth","url":"#spring-boot-example-with-spring-cloud-sleuth","depth":1},{"value":"Visualizing Traces with Zipkin","url":"#visualizing-traces-with-zipkin","depth":3},{"value":"Conclusion","url":"#conclusion","depth":1},{"value":"YouTube Video","url":"#youtube-video","depth":2}],"frontMatter":{"readingTime":{"text":"8 min read","minutes":7.8,"time":468000,"words":1560},"slug":"2021/distributed-tracing-with-spring-cloud-sleuth","fileName":"2021/distributed-tracing-with-spring-cloud-sleuth.md","title":"Distributed Tracing with Spring Cloud Sleuth And Zipkin","author":"Amrut Prabhu","tags":["Spring Boot","Java","Distributed Tracing","Zipkin"],"photo-credits":"https://unsplash.com/photos/d9ILr-dbEdg","applaud-link":"2021/distributed-tracing-with-spring-zipkin.json","date":"2021-08-19T00:00:00.000Z","draft":false,"summary":"We would learn how we can implement distributed tracing in a Spring Boot Application and understand the key concepts of distributed tracing","imageUrl":"/static/images/2021/distributed-tracing-with-zipkin/cover.jpg","actualUrl":"2021/distributed-tracing-with-spring-cloud-sleuth","customUrl":"distributed-tracing-with-spring-cloud-sleuth"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Micronaut JPA Application Performance on AWS Lambda","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Micronaut","AWS","AWS Lambda","Native Image","Java"],"image":"micronaut-lambda-application/cover.jpg","photo-credits":null,"applaud-link":"micronaut-aws-lambda-application-for-api-gateway.json","date":"2021-08-12T00:00:00.000Z","draft":false,"summary":"In this article, we would be looking into how we can deploy a Micronaut application providing GET, PUT and POST which can be called using an API Gateway and check its performance","imageUrl":"/static/images/2021/micronaut-lambda-application/cover.jpg","actualUrl":"2020/micronaut-aws-lambda-application-for-api-gateway","customUrl":"micronaut-aws-lambda-application-for-api-gateway","slug":"micronaut-aws-lambda-application-for-api-gateway"},"next":{"title":"Spring Cloud Gateway Keycloak OAuth2 OIDC Integration","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Java","Gateway","Keycloak","Oauth2","OpenId Connect"],"photo-credits":"","applaud-link":"2021/spring-gateway-oauth2-keycloak.json","date":"2021-09-02T00:00:00.000Z","draft":false,"summary":"In this article, we would be looking at how we can integrate Keycloak with Spring Cloud Gateway using the OAuth2 OpenId Connect (OIDC).","imageUrl":"/static/images/2021/spring-cloud-gateway-with-keycloak/cover.jpg","actualUrl":"2021/spring-cloud-gateway-keycloak-oauth2-openid-connect","customUrl":"spring-cloud-gateway-keycloak-oauth2-openid-connect","slug":"spring-cloud-gateway-keycloak-oauth2-openid-connect"}},"__N_SSG":true},"page":"/[slug]","query":{"slug":"distributed-tracing-with-spring-cloud-sleuth"},"buildId":"onNiRdjbaCBBK8GjKpe72","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>