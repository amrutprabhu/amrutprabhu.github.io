{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var h=Object.create;var l=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var o=a=>l(a,\"__esModule\",{value:!0});var g=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),f=(a,s)=>{o(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},y=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of m(s))!N.call(a,e)&&e!==\"default\"&&l(a,e,{get:()=>s[e],enumerable:!(c=u(s,e))||c.enumerable});return a},w=a=>y(o(l(a!=null?h(k(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var d=g((z,r)=>{r.exports=_jsx_runtime});var j={};f(j,{default:()=>v,frontmatter:()=>S});var n=w(d()),S={title:\"KStreams, Kafka Streams \\u2014 Aggregate, Transform, and Join With Windowing using Spring Cloud Stream\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Java\",\"Spring Boot\",\"Kakfa\",\"Spring cloud Stream\",\"Kstream\",\"kafka stream\"],\"photo-credits\":null,\"applaud-link\":\"2021/spring-boot-stream-kafka.json\",date:\"2023-08-24\",draft:!1,summary:\"In this article, we will explore Kstreams or Kafka Streams with aggregate, join, and windowing concepts using Spring Cloud Stream Kafka Streams\",imageUrl:\"/static/images/2023/spring-cloud-kafka-stream-aggregate-join-window/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h3:\"h3\",a:\"a\",span:\"span\",p:\"p\",h2:\"h2\",ul:\"ul\",li:\"li\",div:\"div\",code:\"code\",pre:\"pre\",strong:\"strong\"},a.components),{Image:t,AdsFlows:i}=e;return i||p(\"AdsFlows\",!0),t||p(\"Image\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h3,{id:\"kstreams-kafka-streamsaggregate-transform-and-join-using-spring-cloud-stream\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#kstreams-kafka-streamsaggregate-transform-and-join-using-spring-cloud-stream\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"KStreams, Kafka Streams\\u200A\\u2014\\u200AAggregate, Transform, and Join using Spring Cloud Stream\"]}),`\n`,(0,n.jsx)(e.p,{children:\"In this article, we will explore Kstreams or Kafka Streams with aggregate, join, and windowing concepts using Spring Cloud Stream Kafka Streams\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-a-project-with-spring-cloud-streams\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-a-project-with-spring-cloud-streams\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating a project with Spring Cloud Streams\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Go to \",(0,n.jsx)(e.a,{href:\"https://start.spring.io\",children:\"https://start.spring.io\"}),\" and add the following dependencies\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Cloud Stream\"}),`\n`,(0,n.jsx)(e.li,{children:\"Spring For Apache Kafka\"}),`\n`,(0,n.jsx)(e.li,{children:\"Spring For Apache Kafka Streams\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"The goal will be to create a pipeline like the one below to explore various concepts like transformation, aggregation, and joining in KStreams or Kafka Streams.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"kafka-streams-pipeline-example\",src:\"/static/images/2023/spring-cloud-kafka-stream-aggregate-join-window/kafka-streams-pipeline-example.png\",width:\"1348\",height:\"447\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"So first let\\u2019s create the producer that will send messages to the Kafka Topic \",(0,n.jsx)(e.code,{children:\"first-topic\"}),\" every second.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can refer to the entire code on my GitHub Repo \",(0,n.jsx)(e.a,{href:\"https://github.com/amrutprabhu/kafka-workouts/tree/master/spring-cloud-stream-kafka-streams-with-kstreams\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-a-kafka-publisher-with-spring-cloud-stream-kafka\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-a-kafka-publisher-with-spring-cloud-stream-kafka\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating a Kafka Publisher with Spring Cloud Stream Kafka\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Spring Cloud Stream makes use of functional interfaces from \",(0,n.jsx)(e.code,{children:\"java.util.function\"}),\" package to define producers and consumers.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Hence we will create a simple supplier bean that will supply values as a producer.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Supplier\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"org\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"springframework\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"messaging\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"})]}),\"Message\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MyEvent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"producer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// random department\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Department\"}),\" department \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Department\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"values\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Random\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"nextInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Department\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"values\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Event playload\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MyEvent\"}),\" myEvent \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MyEvent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Jack\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" department\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MessageBuilder\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withPayload\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"myEvent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"setHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KafkaHeaders\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KEY\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" department\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"build\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here I am creating a producer that will send a message called MyEvent which has a name and department that will be chosen randomly.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Here, the message key is the department and we wrap the payload using the MessageBuilder from Spring.\"}),`\n`,(0,n.jsx)(i,{id:\"adflow1\",slot:\"8168941152\"}),`\n`,(0,n.jsx)(e.p,{children:\"This is how we can create a simple producer that produces a message every second.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now, let's look at the properties required for this.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"spring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"cloud\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"function\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"definition\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` producer\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"stream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"kafka\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"binder\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"brokers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" localhost\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"9092\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"configuration\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"key.serializer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.StringSerializer\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here we set three things:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"The Binding\"}),\": This registers the binding function\\u2019s parameter.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"The producer configuration\"}),\": To specify the key serializer.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"The Spring Cloud Function definition\"}),\": This is the bean definition of binding.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can read this article \",(0,n.jsx)(e.a,{href:\"https://refactorfirst.com/spring-cloud-stream-with-kafka-communication\",children:\"here\"}),\", wherein I explain in detail how these properties are set, what is the meaning of the \",(0,n.jsx)(e.code,{children:\"-out-\"}),\" property, and how the bindings work.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"I would recommend reading it as it will make it easier to understand the next section in which we will be exploring how we can deal with Kafka Streams or KStreams\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-a-kstream-or-kafka-stream-transformation\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-a-kstream-or-kafka-stream-transformation\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating a KStream or Kafka Stream Transformation\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s consider we want to create a handler that will transfer an input stream and send it out to another Kafka Stream\"}),`\n`,(0,n.jsx)(e.p,{children:\"So our producer above is emitting events and now we will transform them and send them to a new topic.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now the transformation is as simple as defining the following functional bean.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Function\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MyEvent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"enhancer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" input \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),` input\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"mapValues\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"It just takes the input and transforms it by mapping the value which was originally a JSON object to the name inside the JSON Object.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Next, we need to configure the enhancer in the properties file.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"spring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"cloud\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"function\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"definition\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` producer;enhancer\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"stream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"kafka\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"streams\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#   only required if you need to provide some configurations.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"consumer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"keySerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.Serdes$StringSerde\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"valueSerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" com.amrut.prabhu.dto.coverters.MyEventSerDes \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#custom\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"binder\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"brokers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" localhost\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"9092\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"configuration\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"key.serializer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.StringSerializer\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" second\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here, we do three things.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"We specify the binding for our enhancer. We specify the topics from which we want to read and write messages to\"}),`\n`,(0,n.jsx)(e.li,{children:\"Our Spring Cloud function definition i.e. enhancer\"}),`\n`,(0,n.jsx)(e.li,{children:\"And finally the key and value serializer and deserializer in the Kafka Streams bindings.\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"So here we are creating our custom value serializer which is a simple Json serializer deserializer.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MyEventSerDes\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"JsonSerde\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MyEvent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Make sure you look at the properties carefully, as they can be confused with the properties defined under \",(0,n.jsx)(e.code,{children:\"spring.cloud.stream.kafka\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The serializer and deserializer properties are defined under the \",(0,n.jsx)(e.code,{children:\"spring.cloud.stream.kafka.streams\"}),\" umbrella.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"So be careful about it.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"With this, the input KStream or Kafka Stream coming from the topic \",(0,n.jsx)(e.code,{children:\"first-topic\"}),\"looks like this:\"]}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"first-kafka-stream-output\",src:\"/static/images/2023/spring-cloud-kafka-stream-aggregate-join-window/first-kafka-stream-output.webp\",width:\"1462\",height:\"248\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"While the output sent to the topic \",(0,n.jsx)(e.code,{children:\"second-topic\"}),\" looks like this:\"]}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"second-kafka-stream-output\",src:\"/static/images/2023/spring-cloud-kafka-stream-aggregate-join-window/second-kafka-stream-output.webp\",width:\"1146\",height:\"222\"})}),`\n`,(0,n.jsx)(e.p,{children:\"The images above is using the following format to show the contents of the Kafka topic.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsx)(e.code,{className:\"language-shell code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Partition: \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"Topic partition number\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\":\"}),\" Offset: \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"Topic offset\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"Key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"Value\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"We will be using the same format to view the messages in the topics as we go ahead.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now let\\u2019s look at how we can aggregate data from one stream and send it to another.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"aggregate-data-from-kstream-or-kafka-stream-with-windowing\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#aggregate-data-from-kstream-or-kafka-stream-with-windowing\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Aggregate Data From KStream Or Kafka Stream With Windowing\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let\\u2019s aggregate data from the \",(0,n.jsx)(e.code,{children:\"first-topic\"}),\" for a time window of 10 seconds and send it over to a \",(0,n.jsx)(e.code,{children:\"third-topic\"}),\" .\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Function\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MyEvent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"aggregate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" input \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),` input\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupByKey\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"windowedBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"TimeWindows\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ofSizeWithNoGrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Duration\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ofSeconds\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"aggregate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0l\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" aggregate\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" aggregate \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Materialized\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Serdes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"String\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Serdes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Long\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"suppress\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Suppressed\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"untilWindowCloses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Suppressed\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BufferConfig\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"unbounded\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"toStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"w\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KeyValue\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"w\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" v\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"toString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here we first group the data by the key within a window size of 10 seconds.\"}),`\n`,(0,n.jsx)(e.p,{children:\"In the aggregate function, the first parameter is the initial value of 0 for the aggregate. The second parameter is an aggregate function that increments by 1 for every value with the same key in the 10-second window (simulating a count aggregation)\"}),`\n`,(0,n.jsx)(e.p,{children:\"The final parameter is used to specify the serializer and deserializer to materialize the results of the time window in an intermediate topic.\"}),`\n`,(0,n.jsx)(e.p,{children:\"After the aggregate function, we have to specify the suppression, or else the intermediate values during the aggregation window will be sent out to the output topic.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now, let's look at the properties.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"spring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"cloud\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"function\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"definition\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` producer;enhancer;aggregate\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"stream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"kafka\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"streams\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#   only required if you need to provide some configurations.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"consumer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"keySerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.Serdes$StringSerde\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"valueSerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" com.amrut.prabhu.dto.coverters.MyEventSerDes \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#custom\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"aggregate-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"consumer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"keySerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.Serdes$StringSerde\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"valueSerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" com.amrut.prabhu.dto.coverters.MyEventSerDes \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#custom\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"binder\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"brokers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" localhost\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"9092\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"configuration\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"key.serializer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.StringSerializer\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" second\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"aggregate-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"aggregate-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" third\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here we also provide three things.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"The binding specifies the input and output topic.\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"The binding function definition under the property \",(0,n.jsx)(e.code,{children:\"spring.cloud.function.definiton\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Finally the consumer properties under \",(0,n.jsx)(e.code,{children:\"spring.cloud.stream.kafka.streams\"}),\" specifying the key and value serializer and deserializer.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"With this, the data will be produced every 10 seconds on the \",(0,n.jsx)(e.code,{children:\"third-topic\"}),\" as shown below.\"]}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"third-kafka-stream-aggregate-output\",src:\"/static/images/2023/spring-cloud-kafka-stream-aggregate-join-window/third-kafka-stream-aggregate-output.webp\",width:\"1380\",height:\"576\"})}),`\n`,(0,n.jsx)(e.p,{children:\"So this is the aggregated count per key in a time window of 10 seconds.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"With this let\\u2019s look at how we can join data from the \",(0,n.jsx)(e.code,{children:\"second-topic\"}),\" and the \",(0,n.jsx)(e.code,{children:\"third-topic\"}),\" and produce the joined value in the \",(0,n.jsx)(e.code,{children:\"fourth-topic\"}),\" .\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"using-join-on-kstreams-or-kafka-streams-with-windowing\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#using-join-on-kstreams-or-kafka-streams-with-windowing\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Using Join On KStreams or Kafka Streams with Windowing\"]}),`\n`,(0,n.jsx)(e.p,{children:\"To create a Join of two Kafka Streams we will make use of a Bifunction.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-Java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Bean\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"BiFunction\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"KStream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"JoinedValue\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"join\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"input1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" input2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" input1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"join\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"input2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" value2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"JoinedValue\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" value2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"JoinWindows\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ofTimeDifferenceWithNoGrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Duration\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"of\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ChronoUnit\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SECONDS\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"StreamJoined\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Serdes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"String\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Serdes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"String\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Serdes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"String\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"In the function above, we take the messages from the \",(0,n.jsx)(e.code,{children:\"second-topic\"}),\" and join them directly with the messages from the \",(0,n.jsx)(e.code,{children:\"third-topic\"}),\" for a time window of 10 seconds resulting in a cartesian product.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Every message will be combined with a message from the other topic based on the key. This will result in an output just like a full join in SQL.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s look at the properties.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"spring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"cloud\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"function\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"definition\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` producer;enhancer;aggregate;join\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"stream\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"kafka\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"streams\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#   only required if you need to provide some configurations.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"consumer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"keySerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.Serdes$StringSerde\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"valueSerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" com.amrut.prabhu.dto.coverters.MyEventSerDes \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#custom\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"aggregate-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"consumer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"keySerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.Serdes$StringSerde\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"valueSerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" com.amrut.prabhu.dto.coverters.MyEventSerDes \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#custom\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"join-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"keySerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.Serdes$StringSerde\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"valueSerde\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` com.amrut.prabhu.dto.coverters.JoinedValueSerDes\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"binder\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"brokers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" localhost\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"9092\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"configuration\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"key.serializer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` org.apache.kafka.common.serialization.StringSerializer\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"bindings\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"producer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"enhancer-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" second\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"aggregate-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" first\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"aggregate-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" third\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"join-in-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" second\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"join-in-1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" third\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"join-out-0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"destination\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" fourth\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`topic\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here, if you look carefully, in the binding we specify two inputs and one output.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The rest is the same as adding the function definition and the serializer and deserializer properties as we did for the other bindings above.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"When we run this, it produces the following messages on the \",(0,n.jsx)(e.code,{children:\"fourth-topic\"})]}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"fourth-kafka-stream-join-output\",src:\"/static/images/2023/spring-cloud-kafka-stream-aggregate-join-window/fourth-kafka-stream-join-output.webp\",width:\"1324\",height:\"700\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can refer to the entire code on my GitHub Repo \",(0,n.jsx)(e.a,{href:\"https://github.com/amrutprabhu/kafka-workouts/tree/master/spring-cloud-stream-kafka-streams-with-kstreams\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"If you are interested in learning more about Java and Spring Boot, here are some interesting articles to look at.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://refactorfirst.com/spring-boot-3-with-docker-compose-support\",children:(0,n.jsx)(e.strong,{children:\"Spring Boot 3.1 Docker Compose Support\"})})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://refactorfirst.com/defining-event-driven-achitectures-asyncapi\",children:(0,n.jsx)(e.strong,{children:\"Defining Event-Driven Architectures\\u200A\\u2014\\u200AAsyncAPI\"})})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://refactorfirst.com/how-does-fido2-passwordless-authentication-work\",children:(0,n.jsx)(e.strong,{children:\"FIDO2 Passwordless Authentication With KeyCloak\"})})}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I keep exploring and learning new things. If you want to know the latest trends and improve your software development skills, then subscribe to my newsletter below and also follow me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/amrutprabhu42\",children:\"Twitter\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Enjoy!!\"})]})}}var v=b;function p(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return j;})();\n;return Component;","toc":[{"value":"KStreams, Kafka Streams — Aggregate, Transform, and Join using Spring Cloud Stream","url":"#kstreams-kafka-streamsaggregate-transform-and-join-using-spring-cloud-stream","depth":3},{"value":"Creating a project with Spring Cloud Streams","url":"#creating-a-project-with-spring-cloud-streams","depth":2},{"value":"Creating a Kafka Publisher with Spring Cloud Stream Kafka","url":"#creating-a-kafka-publisher-with-spring-cloud-stream-kafka","depth":2},{"value":"Creating a KStream or Kafka Stream Transformation","url":"#creating-a-kstream-or-kafka-stream-transformation","depth":2},{"value":"Aggregate Data From KStream Or Kafka Stream With Windowing","url":"#aggregate-data-from-kstream-or-kafka-stream-with-windowing","depth":2},{"value":"Using Join On KStreams or Kafka Streams with Windowing","url":"#using-join-on-kstreams-or-kafka-streams-with-windowing","depth":2}],"frontMatter":{"readingTime":{"text":"13 min read","minutes":12.09,"time":725400,"words":2418},"slug":"2023/spring-cloud-kafka-streams-aggregate-join-windowing","fileName":"2023/spring-cloud-kafka-streams-aggregate-join-windowing.md","title":"KStreams, Kafka Streams — Aggregate, Transform, and Join With Windowing using Spring Cloud Stream","author":"Amrut Prabhu","categories":"","tags":["Java","Spring Boot","Kakfa","Spring cloud Stream","Kstream","kafka stream"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2023-08-24T00:00:00.000Z","draft":false,"summary":"In this article, we will explore Kstreams or Kafka Streams with aggregate, join, and windowing concepts using Spring Cloud Stream Kafka Streams","imageUrl":"/static/images/2023/spring-cloud-kafka-stream-aggregate-join-window/cover.jpg","actualUrl":"2023/spring-cloud-kafka-streams-aggregate-join-windowing","customUrl":"spring-cloud-kafka-streams-aggregate-join-windowing"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"How to Search & Query Redis with A Spring Boot Application","author":"Amrut Prabhu","categories":"","tags":["Java","Spring Boot","Redis Search","Redis JSON","Redis Hash","Redis Insight"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2023-07-13T00:00:00.000Z","draft":false,"summary":"In this article, we will look into how you can search and query Redis using a Spring Boot Application and also visualize this using Redis Insights","imageUrl":"/static/images/2023/spring-boot-with-redis/cover.jpg","actualUrl":"2023/spring-boot-with-redis-stack-and-redis-insight","customUrl":"spring-boot-with-redis-stack-and-redis-insight","slug":"spring-boot-with-redis-stack-and-redis-insight"},"next":null},"__N_SSG":true}