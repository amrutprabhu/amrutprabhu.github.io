{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var p=Object.create;var s=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var o=a=>s(a,\"__esModule\",{value:!0});var m=(a,i)=>()=>(i||a((i={exports:{}}).exports,i),i.exports),f=(a,i)=>{o(a);for(var c in i)s(a,c,{get:i[c],enumerable:!0})},N=(a,i,c)=>{if(i&&typeof i==\"object\"||typeof i==\"function\")for(let n of d(i))!g.call(a,n)&&n!==\"default\"&&s(a,n,{get:()=>i[n],enumerable:!(c=h(i,n))||c.enumerable});return a},k=a=>N(o(s(a!=null?p(u(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=m((S,l)=>{l.exports=_jsx_runtime});var x={};f(x,{default:()=>v,frontmatter:()=>w});var e=k(r()),w={title:\"Externalizing Application Configuration With Spring Cloud Config\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Spring Boot\",\"Java\",\"Configuration\",\"Spring cloud config server\",\"Spring cloud\"],image:\"2021/spring-cloud-config-server-git-backend/cover.jpg\",\"photo-credits\":null,\"applaud-link\":\"2021/externalizing-config-with-spring-cloud-config.json\",date:\"2021-10-14\",draft:!1,summary:\"In this article, we would be looking at how we can externalize application configuration using Spring Cloud Config.\",imageUrl:\"/static/images/2021/spring-cloud-config-server-git-backend/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function y(a={}){let{wrapper:i}=a.components||{};return i?(0,e.jsx)(i,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",h1:\"h1\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",h2:\"h2\",pre:\"pre\",code:\"code\",div:\"div\",h4:\"h4\",blockquote:\"blockquote\"},a.components),{Image:t}=n;return t||b(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"In this article, we would be looking at how we can externalize configs using Spring Cloud Config.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"introduction\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#introduction\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"One of the principles from the \",(0,e.jsx)(n.a,{href:\"https://12factor.net/config\",children:\"12 Factor App\"}),\", states that we have to separate our application configuration from the code. The configuration varies based on the environment and it's better to organize them based on the environment your application is running.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"So in this article, we will be looking at how we can externalize configurations with Spring Cloud Config.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"spring-cloud-config\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#spring-cloud-config\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Spring Cloud Config\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Spring cloud config consists of two parts.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"A server to provide the configuration\"}),`\n`,(0,e.jsx)(n.li,{children:\"A client to fetch the configuration.\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s look at how we can set up the spring cloud config server to provide configuration to any application.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"spring-cloud-config-server\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#spring-cloud-config-server\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Spring Cloud Config Server\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Let\\u2019s go to \",(0,e.jsx)(n.a,{href:\"https://start.spring.io\",children:\"https://start.spring.io\"}),\" and create a project with the following dependencies.\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Spring Cloud Config Server\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Once you open the project, we need to configure the application to allow it to serve configuration. Now, the server can be configured with quite a few backends with which you can organize any client\\u2019s configuration. Here is a list of some of the supported backend.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Git URL\"}),`\n`,(0,e.jsx)(n.li,{children:\"AWS S3 bucket.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Redis\"}),`\n`,(0,e.jsx)(n.li,{children:\"File System location.\"}),`\n`,(0,e.jsx)(n.li,{children:\"HashiCorp Vault.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Cloudfoundary\\u2019s CredHub.\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"These are some of the popular ones I have listed, but a few more backends can be integrated. You can find the list \",(0,e.jsx)(n.a,{href:\"https://cloud.spring.io/spring-cloud-config/reference/html/#_environment_repository\",children:\"here\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"Today we will explore how to configure Spring Cloud Config server with Git URL as the backend.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"configuring-spring-cloud-config-with-git\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#configuring-spring-cloud-config-with-git\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Configuring Spring Cloud Config with Git\"]}),`\n`,(0,e.jsx)(n.p,{children:\"To configure this, we will jump to the properties file.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s start with the most basic config.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"server\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8888\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spring\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"cloud\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"server\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"git\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"uri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//github.com/amrutprabhu/spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"boot\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"external\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"configuration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`options\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"This is the most minimalistic configuration required to use a git repo as a store for our client configurations.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now, Let's create some configuration files, in the git repo.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here we have to organize the application property file names in the format \",(0,e.jsx)(n.code,{children:\"{client.application.name}-{profile}.yaml (or .properties)\"}),\" .\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"For this example, we will only be setting the \",(0,e.jsx)(n.code,{children:\"server.port\"}),\" property in the property files, so that the server starts on a different port depending on the profile.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Throughout this example, we would be considering a client whose application name is \\u201Cconfig-client\\u201D.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"config files\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/root.png\",width:\"693\",height:\"347\"})}),`\n`,(0,e.jsx)(n.p,{children:\"With this Let\\u2019s start the application.\"}),`\n`,(0,e.jsx)(n.p,{children:\"We can test the server to check the config it fetches for different profiles. To check this, we can hit the server with the following URL format.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`http://localhost:8888/{client.application.name}/{profile}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`e.g\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`http://localhost:8888/config-client/dev\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"On hitting the above URL, we get the following.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"dev profile call\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/root-test-call.png\",width:\"843\",height:\"489\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"As you can see, it is fetching the default config as well as the dev config here. This means that when the client starts up with the profile \",(0,e.jsx)(n.code,{children:\"dev\"}),\" , it will use the properties from the dev YAML file, overriding the properties from the default file just as if the files had to be locally available to the client. Hence we get both the default as well as the dev-specific properties file.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"customizing-config-location-with-different-repositories\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#customizing-config-location-with-different-repositories\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Customizing Config Location with Different Repositories\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now, What if you want to organize the properties files in different repository locations?\"}),`\n`,(0,e.jsx)(n.p,{children:\"For example, we want to have a different repo for each environment. To do this we will extend the properties further as follows.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"server\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8888\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spring\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"cloud\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"server\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"git\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"uri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//github.com/amrutprabhu/spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"boot\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"external\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"configuration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`options\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"repos\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"staging-properties-repo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"pattern\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client/staging\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"uri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//github.com/amrutprabhu/spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"boot\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"external\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"configuration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`options\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"search-paths\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cloud\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"setup/configs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`location\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, here I have specified a repo name \",(0,e.jsx)(n.code,{children:\"staging-properties-repo\"}),\" with a repo URI, a search path, and a pattern. For this example, I am using the same git repo, but you can use a completely different git repo that you want.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, here we can specify a pattern which is of the following format : \",(0,e.jsx)(n.code,{children:\"{client's application name}/{client's application profile}\"}),\" . As it's a pattern you can use wild card patterns. e.g\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`config-client*/*\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`config-client/dev-*\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`config-*/dev*\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Next, the \",(0,e.jsx)(n.code,{children:\"search-paths\"}),\" property helps you to define locations, under which the config can be searched.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Since I have moved the properties under two subfolders I have mentioned the subfolder location in the \",(0,e.jsx)(n.code,{children:\"search-paths\"}),\".\"]}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"config in sub folder\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/moved-to-sub-folder.png\",width:\"901\",height:\"338\"})}),`\n`,(0,e.jsx)(n.p,{children:\"On restarting the application and hitting the URL, we get the following output for the staging profile.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"staging profile call\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/staging-test-call.png\",width:\"1225\",height:\"486\"})}),`\n`,(0,e.jsxs)(n.h4,{id:\"customizing-search-patterns\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#customizing-search-patterns\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Customizing Search patterns\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We can customize the configuration using some reserved placeholders.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"{application}\"}),\" - to refer to the client\\u2019s application name.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"{profile}\"}),\" - to refer to the client\\u2019s application profile.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Let use these placeholders to add some more repos.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"prod-properies-repo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"uri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//github.com/amrutprabhu/spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"boot\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"external\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"configuration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`options\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"pattern\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client/prod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"search-paths\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cloud\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"setup/configs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"location/\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"profile\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"any-request-repo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"uri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//github.com/amrutprabhu/spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"boot\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"external\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"configuration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`options\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"pattern\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token important\",children:\"*/*\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"search-paths\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cloud\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"setup/configs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"location/\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"application\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"profile\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now here, the first repo has the profile name as the subdirectory to search for when the request comes in for the\",(0,e.jsx)(n.code,{children:\"prod\"}),\" profile.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In the second one, if any other request comes in, then it would use the client application name and the profile subdirectory tree. Here is how the folders are organized.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"git folder structure\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/git-folder-structure.png\",width:\"347\",height:\"219\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Now with the new repos added, let\\u2019s restart the application and test the output.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"prod profile call\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/prod-profile.png\",width:\"1261\",height:\"391\"})}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"dev profile call\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/dev-profile.png\",width:\"1339\",height:\"387\"})}),`\n`,(0,e.jsx)(n.p,{children:\"These are just some ways you can organize your configuration.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now you must be wondering\\u2026\"}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"What happens if the configuration is changed on git when the config server is running?\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"In this case, the config server will automatically pull the new configuration and give it to the requesting client on subsequent requests. No need to restart the config server.\"}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:\"What happens if there is a matching pattern but no properties for that particular profile are found?\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"In this case, it would try to find the properties from the default repo i.e. from the property \",(0,e.jsx)(n.code,{children:\"spring.cloud.config.server.git.uri\"}),\" . If there are no properties available from the default repo, it will return empty Property Sources JSON.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"With this, we are ready with our spring cloud config server.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s create a client for this.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"creating-spring-cloud-config-client\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-spring-cloud-config-client\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating Spring Cloud Config Client.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"For this, We will create an application using \",(0,e.jsx)(n.a,{href:\"https://start.spring.io\",children:\"https://start.spring.io\"}),\" with the following dependencies.\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Spring Cloud Starter Config\"}),`\n`,(0,e.jsx)(n.li,{children:\"Spring Boot Web Starter (required only for tomcat server)\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, let's add some properties to the \",(0,e.jsx)(n.code,{children:\"application.yaml\"}),\" file.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spring\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"application\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"import\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'configserver:'\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now since the \",(0,e.jsx)(n.a,{href:\"https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2020.0-Release-Notes#breaking-changes\",children:\"Spring Cloud 2020.0 version\"}),\", we need to specify from where we want the configs to be loaded. Since we are using a config server, We have to specify the property \",(0,e.jsx)(n.code,{children:'spring.config.import=\"configserver:\"'})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"The location from where the configs will be fetched is added to the\",(0,e.jsx)(n.code,{children:\"bootstrap.yaml\"}),\" file.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spring\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"cloud\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"uri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//localhost\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8888\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"With this let\\u2019s build the application and run it using the following command with a profile argument\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"language-shell code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"java -jar target/config-client-service-0.0.1-SNAPSHOT.jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--spring.profiles.active\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`prod\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The client starts with port 9090, which is what was defined in the prod profile properties file.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"prod profile console\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/clinet-prod-console.png\",width:\"1419\",height:\"362\"})}),`\n`,(0,e.jsx)(n.p,{children:\"On starting the client service with the staging profile, It starts at port 6060\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(t,{alt:\"staging profile console\",src:\"/static/images/2021/spring-cloud-config-server-git-backend/staging-profile-console.png\",width:\"1408\",height:\"424\"})}),`\n`,(0,e.jsxs)(n.h2,{id:\"useful-tip\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#useful-tip\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Useful Tip.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now to test your configuration from the config server, It can become tedious to change the config, push the changes to git and then test the output.\"}),`\n`,(0,e.jsx)(n.p,{children:\"You can make this easy by replacing the git URL with a local directory location where the configs repo is checked out. e.g\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"prod-properies-repo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"uri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" file\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"///home/user/spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"boot\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"external\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"configuration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`options\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"pattern\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client/prod\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"search-paths\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" spring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cloud\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"setup/configs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"location/\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"profile\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"You can then change the files locally and test your config server.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"conclusion\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#conclusion\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We just saw how to configure a spring cloud config server with a git repository backend and use it to start a client application. There have been some changes since spring cloud version 2020.0 and this example demonstrates the integration.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"As usual, I have uploaded the code on \",(0,e.jsx)(n.a,{href:\"https://github.com/amrutprabhu/spring-boot-external-configuration-options/tree/master/spring-cloud-config-server-setup\",children:\"GitHub\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I keep exploring and learning new things. If you want to know the latest trends and improve your software development skills, then subscribe to my newsletter below and also follow me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/amrutprabhu42\",children:\"Twitter\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Enjoy!!\"})]})}}var v=y;function b(a,i){throw new Error(\"Expected \"+(i?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return x;})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":1},{"value":"Spring Cloud Config","url":"#spring-cloud-config","depth":1},{"value":"Spring Cloud Config Server","url":"#spring-cloud-config-server","depth":2},{"value":"Configuring Spring Cloud Config with Git","url":"#configuring-spring-cloud-config-with-git","depth":2},{"value":"Customizing Config Location with Different Repositories","url":"#customizing-config-location-with-different-repositories","depth":2},{"value":"Customizing Search patterns","url":"#customizing-search-patterns","depth":4},{"value":"Creating Spring Cloud Config Client.","url":"#creating-spring-cloud-config-client","depth":2},{"value":"Useful Tip.","url":"#useful-tip","depth":2},{"value":"Conclusion","url":"#conclusion","depth":1}],"frontMatter":{"readingTime":{"text":"9 min read","minutes":8.055,"time":483300,"words":1611},"slug":"2021/externalize-config-with-spring-cloud-config","fileName":"2021/externalize-config-with-spring-cloud-config.md","title":"Externalizing Application Configuration With Spring Cloud Config","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Java","Configuration","Spring cloud config server","Spring cloud"],"image":"2021/spring-cloud-config-server-git-backend/cover.jpg","photo-credits":null,"applaud-link":"2021/externalizing-config-with-spring-cloud-config.json","date":"2021-10-14T00:00:00.000Z","draft":false,"summary":"In this article, we would be looking at how we can externalize application configuration using Spring Cloud Config.","imageUrl":"/static/images/2021/spring-cloud-config-server-git-backend/cover.jpg","actualUrl":"2021/externalize-config-with-spring-cloud-config","customUrl":"externalize-config-with-spring-cloud-config"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Distributed Tracing With Spring Cloud Jaeger","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Java","Jaeger","Distributed Tracing"],"image":"2021/distributed-tracing-with-jaeger/cover.jpg","photo-credits":null,"applaud-link":"2021/distributed-tracing-with-spring-cloud-jaeger.json","date":"2021-09-23T00:00:00.000Z","draft":false,"summary":"In this article, We will explore how to implement distributed tracing in a Spring Boot application using Jaeger and visualize the traces using Jaeger UI","imageUrl":"/static/images/2021/distributed-tracing-with-jaeger/cover.jpg","actualUrl":"2021/distributed-tracing-spring-boot-opentracing-jaeger","customUrl":"distributed-tracing-spring-boot-opentracing-jaeger","slug":"distributed-tracing-spring-boot-opentracing-jaeger"},"next":{"title":"Integrate Caching with Spring Cache and Ehcache 3","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Java","Spring cache","ehcache 3","Jcache"],"image":"2021/spring-cache-ehcache-3/cover.jpg","photo-credits":"","applaud-link":"2021/spring-cache-ehcache-3.json","date":"2021-11-02T00:00:00.000Z","draft":false,"summary":"In this article, we will look into some Spring Cache concepts and then integrate Ehcache 3.","imageUrl":"/static/images/2021/spring-cache-ehcache-3/cover.jpg","actualUrl":"2021/spring-boot-spring-cache-with-ehcache-3","customUrl":"spring-boot-spring-cache-with-ehcache-3","slug":"spring-boot-spring-cache-with-ehcache-3"}},"__N_SSG":true}