{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var i=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var o=a=>i(a,\"__esModule\",{value:!0});var k=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{o(a);for(var t in s)i(a,t,{get:s[t],enumerable:!0})},g=(a,s,t)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)&&n!==\"default\"&&i(a,n,{get:()=>s[n],enumerable:!(t=h(s,n))||t.enumerable});return a},w=a=>g(o(i(a!=null?d(u(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=k((A,l)=>{l.exports=_jsx_runtime});var v={};N(v,{default:()=>b,frontmatter:()=>f});var e=w(r()),f={title:\"Apache Airflow 2.0: A Practical Jump Start\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"python\",\"airflow\",\"Java\"],image:\"airflow/airflow-cover.jpg\",\"photo-credits\":\"https://unsplash.com/photos/BpEOwR57QEg\",\"applaud-link\":\"apache-airflow-2-0-practical-jump-start.json\",date:\"2021-04-28\",draft:!1,summary:\"In this article, I would like to give you a jump-start to understand the basic concepts and create a workflow pipeline from scratch.\",imageUrl:\"/static/images/2021/airflow/airflow-cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({p:\"p\",h1:\"h1\",a:\"a\",span:\"span\",div:\"div\",ul:\"ul\",li:\"li\",ol:\"ol\",pre:\"pre\",code:\"code\"},a.components),{Image:c}=n;return c||_(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"In this article, I would like to give you a jump-start tutorial to understand the basic concepts and create a workflow pipeline from scratch.\"}),`\n`,(0,e.jsx)(n.p,{children:\"So let's get started!\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"introduction\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#introduction\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Apache Airflow is an orchestration tool that helps you to programmatically create and handle task execution into a single workflow. It then handles monitoring its progress and takes care of scheduling future workflows depending on the schedule defined.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Workflows are created using python scripts, which define how your tasks are executed. They are usually defined as Directed Acyclic Graphs(DAG).\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"AirFlow DAG\",src:\"/static/images/2021/airflow/dag.png\",width:\"647\",height:\"236\"})}),`\n`,(0,e.jsx)(n.p,{children:\"The workflow execution is based on the schedule you provide, which is as per Unix cron schedule format. Once you create python scripts and place them in the dags folder of Airflow, Airflow will automatically create the workflow for you.\"}),`\n`,(0,e.jsx)(n.p,{children:\"How difficult are the python scripts?\"}),`\n`,(0,e.jsx)(n.p,{children:\"Well, not difficult but pretty straightforward. Let me explain this.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"key-concepts\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#key-concepts\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Key Concepts\"]}),`\n`,(0,e.jsx)(n.p,{children:\"A workflow is made up of tasks and each task is an operator. Now, what is an operator? An operator a python class that does some work for you. These classes are provided by airflow itself. Some basic operators are\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"BashOperator - used to run bash commands.\"}),`\n`,(0,e.jsx)(n.li,{children:\"PythonOperator - used to run a python function you define.\"}),`\n`,(0,e.jsx)(n.li,{children:\"BranchOperator - used to create a branch in the workflow.\"}),`\n`,(0,e.jsx)(n.li,{children:\"DummyOperator - used to represent a dummy task.\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"There are quite a few other operators that will help you make an HTTP call, connect to a Postgres instance, connect to slack, etc. You can find more operators \",(0,e.jsx)(n.a,{href:\"https://airflow.apache.org/docs/apache-airflow/stable/python-api-ref.html#operators\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Finally, with the theory done, Let\\u2019s do something exciting i.e. create our first Airflow DAG.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"creating-an-airflow-dag\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-an-airflow-dag\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating an Airflow DAG.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"As an example, Let's create a workflow that does the following\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Check if the URL is available\"}),`\n`,(0,e.jsx)(n.li,{children:\"Fetches some data from an URL\"}),`\n`,(0,e.jsx)(n.li,{children:\"Extract certain fields from it.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Print the extracted fields using the bash echo command.\"}),`\n`]}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Example Airflow DAG\",src:\"/static/images/2021/airflow/example_workflow.png\",width:\"583\",height:\"100\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Pretty simple workflow, But there are some useful concepts that I will explain as we go.\"}),`\n`,(0,e.jsx)(n.p,{children:\"So let's start.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"running-apache-airflow-with-docker\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#running-apache-airflow-with-docker\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Running Apache Airflow with Docker\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"The official Airflow site provides a \",(0,e.jsx)(n.a,{href:\"https://airflow.apache.org/docs/apache-airflow/stable/start/docker.html#docker-compose-yaml\",children:\"docker-compose file\"}),\" with all the components needed to run Airflow. Once you download the docker-compose file, You can start it using the docker-compose command.\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`docker-compose up -d\n`})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Once your containers are up and running, a\",(0,e.jsx)(n.code,{children:\"dags\"}),\" folder is created on your local machine where you placed the docker-compose.yml file. We are going to use this \",(0,e.jsx)(n.code,{children:\"dags\"}),\" folder to place our python workflows. You can access the Airflow web UI using the URL \",(0,e.jsx)(n.code,{children:\"localhost:8080\"})]}),`\n`,(0,e.jsxs)(n.h1,{id:\"creating-your-dag-definition\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-your-dag-definition\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating your DAG Definition\"]}),`\n`,(0,e.jsx)(n.p,{children:\"First, we will create a skeleton of the workflow, i.e, in this case, is the DAG definition.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" airflow\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"models \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` DAG\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"default_args \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'start_date'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" datetime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2020\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" DAG\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'user_processing'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         schedule_interval\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@daily'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         default_args\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"default_args\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         catchup\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"False\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" dag\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"With this, you just created a new workflow, But without any tasks to be executed. The first parameter is the name of the DAG, followed by the schedule you want it to be triggered. Then you set some default arguments like \",(0,e.jsx)(n.code,{children:\"start_date\"}),\"telling when actually the DAG can start to trigger.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Next, let's create our first task.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, to check if our URL is reachable, we are going to use a sensor operator. In this case, it's an \",(0,e.jsx)(n.code,{children:\"HttpSensor\"}),\" operator.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" DAG\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'user_content_processing'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         schedule_interval\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@daily'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         default_args\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"default_args\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" dag\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    is_api_available \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" HttpSensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        task_id\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'is_api_available'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        http_conn_id\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'user_api'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        endpoint\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'api/'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"To create the HttpSensor operator, We provide it with a task id, HTTP connection id, and endpoint. The task id identifies the task in the DAG, and the endpoint identifies the API to fetch. Now the third parameter i.e \",(0,e.jsx)(n.code,{children:\"http_conn_id\"}),\" will require something to be explained.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Airflow provides a mechanism to create and store some configurations that you can use across workflows. One such type is configuring \\u201CConnections\\u201D. Here you can provide various connections like AWS connections, ElasticSearch connection, Kubernetes cluster connections, etc.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"In our case, we would be using the HTTP connection option. Here we would provide the URL we want to trigger and setting the connection id to \",(0,e.jsx)(n.code,{children:\"user_api\"}),\" .We want to call the URL \",(0,e.jsx)(n.a,{href:\"https://randomuser.me/api/\",children:\"https://randomuser.me/api/\"}),\", which will return a JSON response of some random user information.\"]}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Airflow Connection Creation\",src:\"/static/images/2021/airflow/airflow-http-connection.png\",width:\"661\",height:\"411\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Finally, with this configured, the task is ready to make a call to the URL with the endpoint provided.\"}),`\n`,(0,e.jsx)(n.p,{children:\"So with that, We just created our first task and learned some concepts.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Airflow DAG task\",src:\"/static/images/2021/airflow/airflow-first-dag-task.png\",width:\"419\",height:\"342\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, once the first task execution succeeds, we want to execute the task that will make the actual call to get user details. For this, we are going to make use of an HttpOperator called \",(0,e.jsx)(n.code,{children:\"SimpleHttpOperator\"}),\".\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"is_api_available \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" HttpSensor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"extracting_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" SimpleHttpOperator\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    task_id\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'extracting_user'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    http_conn_id\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'user_api'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    endpoint\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'api/'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    method\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'GET'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"As you can see, we have the \",(0,e.jsx)(n.code,{children:\"task_id\"}),\"to identify this task, the \",(0,e.jsx)(n.code,{children:\"http_conn_id\"}),\" we spoke about before, the endpoint, and the method you want to execute.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"That's it!\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now you must be wondering what happens to the response. For this let's look into another concept called Xcoms\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"xcoms\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#xcoms\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Xcoms\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Xcoms is a way you can share data between your tasks. It basically stores key-value pairs of the information you want to store that can be accessed by other tasks in a DAG.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"The SimpleHttpOperator stores the response inside these Xcoms. Hence we will use another task to retrieve the value and process it. You can read more about Xcoms \",(0,e.jsx)(n.a,{href:\"https://airflow.apache.org/docs/apache-airflow/stable/concepts.html?highlight=xcom#xcoms\",children:\"here\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Once the data is fetched, We are going to create a processor, which will process the data that was pushed into Xcoms by the previous task. We will do this using a python function and hence the new operator that we are going to use is the \",(0,e.jsx)(n.code,{children:\"PythonOperator\"}),\".\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"fetch_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" SimpleHttpOperator\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"processing_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" PythonOperator\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    task_id\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'processing_user'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    python_callable\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`_processing_user\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"DAG Tasks\",src:\"/static/images/2021/airflow/airflow-dag-tasks.png\",width:\"687\",height:\"365\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"PythonOperator\"}),\" is a simple operator, that takes the \",(0,e.jsx)(n.code,{children:\"task_id\"}),\" and a python callable function. Let\\u2019s look at the function.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"_processing_user\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ti\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    users_txt \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" ti\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"xcom_pull\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"task_ids\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"extracting_user\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    users \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"loads\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"users_txt\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'results'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"raise\"}),\" ValueError\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"User is empty\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'results'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    user_map \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'firstname'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'name'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'first'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'lastname'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'name'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'last'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    processed_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" json_normalize\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"user_map\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    Variable\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"set\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"user\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" processed_user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"So this function receives a Task Instance (referred as \",(0,e.jsx)(n.code,{children:\"ti\"}),\"). We use this task instance to get the information that our task \",(0,e.jsx)(n.code,{children:\"extracting_user\"}),\" has pushed to Xcoms, using \",(0,e.jsx)(n.code,{children:\"xcom_pull\"}),\" call. We then validate the input and extract some fields as a dictionary. Finally, we normalize the dictionary and add it to something called \",(0,e.jsx)(n.code,{children:\"Variables\"}),\". Let\\u2019s look at what are Variables.\"]}),`\n`,(0,e.jsxs)(n.h1,{id:\"variables\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#variables\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Variables\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Variables are a way to store and extract some values that you would like to use across any DAG. It's basically a key-value store of arbitrary data. You can read more in detail about it \",(0,e.jsx)(n.a,{href:\"https://airflow.apache.org/docs/apache-airflow/stable/concepts.html?highlight=xcom#variables\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now that we have stored the values inside Variables, Let print them to the logs using the \",(0,e.jsx)(n.code,{children:\"echo\"}),\" command. To do this we are going to use the \",(0,e.jsx)(n.code,{children:\"BashOperator\"})]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\" raw \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"processing_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" PythonOperator\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"print_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" BashOperator\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    task_id\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'log_user'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    bash_command\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:`'echo \"{{ var.value.user }}\"'`}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\" endraw \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"In this, I will explain to you another important concept called Templating.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"templating\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#templating\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Templating\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Airflow uses \",(0,e.jsx)(n.a,{href:\"https://jinja.palletsprojects.com/\",children:\"Jinja Templating\"}),\". As you have seen in the code above, I have used curly braces which allow me to materialize some values. In this case, I have extracted the \",(0,e.jsx)(n.code,{children:\"user\"}),\" key from Variables (using \",(0,e.jsx)(n.code,{children:\"var\"}),\" ) which I had stored using the previous task.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now how would you know if the particular operator supports templating? For this, you can search for \\u201Ctemplate_fields\\u201D in the API reference of the operator, Which will tell you which fields support templating. e.g You can have a look at the HttpSensor operator reference \",(0,e.jsx)(n.a,{href:\"https://airflow.apache.org/docs/apache-airflow-providers-http/stable/_api/airflow/providers/http/sensors/http/index.html\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h1,{id:\"ordering-your-tasks\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#ordering-your-tasks\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Ordering Your Tasks\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, With all of this, we have created all the tasks instances. But we still have to order the tasks. To do this, we make use of the \",(0,e.jsx)(n.code,{children:\"<<\"}),\" operator. You define it as\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Task \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<<\"}),\" Task \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"This means Task 1 will run before Task 2. In our case, we will order this as\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsx)(n.code,{className:\"language-python code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"is_api_available \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">>\"}),\" fetch_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">>\"}),\" processing_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">>\"}),` print_user\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"And there we go. We just created a simple Airflow DAG workflow from scratch covering some of the important concepts of Airflow. Now, enable the DAG and hit run. It will start executing.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Apache Airflow Successful Execution\",src:\"/static/images/2021/airflow/airflow-dag-successful-run.png\",width:\"1340\",height:\"544\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"As usual, I have uploaded the code on \",(0,e.jsx)(n.a,{href:\"https://github.com/amrutprabhu/airflow-workouts/blob/master/dags/user_data_processing.py\",children:\"GitHub\"}),\". :)\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Enjoy!!\"})]})}}var b=y;function _(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return v;})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":1},{"value":"Key Concepts","url":"#key-concepts","depth":1},{"value":"Creating an Airflow DAG.","url":"#creating-an-airflow-dag","depth":1},{"value":"Running Apache Airflow with Docker","url":"#running-apache-airflow-with-docker","depth":1},{"value":"Creating your DAG Definition","url":"#creating-your-dag-definition","depth":1},{"value":"Xcoms","url":"#xcoms","depth":1},{"value":"Variables","url":"#variables","depth":1},{"value":"Templating","url":"#templating","depth":1},{"value":"Ordering Your Tasks","url":"#ordering-your-tasks","depth":1}],"frontMatter":{"readingTime":{"text":"9 min read","minutes":8.41,"time":504600,"words":1682},"slug":"2020/apache-airflow-2-0-practical-jump-start","fileName":"2020/apache-airflow-2-0-practical-jump-start.md","title":"Apache Airflow 2.0: A Practical Jump Start","author":"Amrut Prabhu","categories":"","tags":["python","airflow","Java"],"image":"airflow/airflow-cover.jpg","photo-credits":"https://unsplash.com/photos/BpEOwR57QEg","applaud-link":"apache-airflow-2-0-practical-jump-start.json","date":"2021-04-28T00:00:00.000Z","draft":false,"summary":"In this article, I would like to give you a jump-start to understand the basic concepts and create a workflow pipeline from scratch.","imageUrl":"/static/images/2021/airflow/airflow-cover.jpg","actualUrl":"2020/apache-airflow-2-0-practical-jump-start","customUrl":"apache-airflow-2-0-practical-jump-start"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Spring Boot: API First Design","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Java","Open API 3","Swagger"],"image":"blog-api-first/cover.jpg","photo-credits":"https://unsplash.com/photos/bb-ys3oFql4","applaud-link":"spring-boot-api-first-design.json","date":"2021-03-21T00:00:00.000Z","draft":false,"summary":"Here we take a practical approach to API first design with an example using Open API 3 specification","imageUrl":"/static/images/2021/blog-api-first/cover.jpg","actualUrl":"2020/spring-boot-api-first-design","customUrl":"spring-boot-api-first-design","slug":"spring-boot-api-first-design"},"next":{"title":"Kind - A New Kubernetes Cluster","author":"Amrut Prabhu","categories":"","tags":["kubernetes","Java"],"image":"kind/kind-kubernetes.png","photo-credits":null,"applaud-link":"kind-kubernetes-cluster.json","date":"2021-05-13T00:00:00.000Z","draft":false,"summary":"Here we explore how to create a kubernetes cluster on your local machine","imageUrl":"/static/images/2021/kind/kind-kubernetes.png","actualUrl":"2020/kind-kubernetes-cluster","customUrl":"kind-kubernetes-cluster","slug":"kind-kubernetes-cluster"}},"__N_SSG":true}