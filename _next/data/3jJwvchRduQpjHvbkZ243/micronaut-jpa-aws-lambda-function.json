{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var i=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var l=a=>i(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{l(a);for(var t in s)i(a,t,{get:s[t],enumerable:!0})},g=(a,s,t)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!u.call(a,e)&&e!==\"default\"&&i(a,e,{get:()=>s[e],enumerable:!(t=p(s,e))||t.enumerable});return a},w=a=>g(l(i(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((j,o)=>{o.exports=_jsx_runtime});var x={};k(x,{default:()=>v,frontmatter:()=>b});var n=w(r()),b={title:\"Micronaut JPA Function Performance on AWS Lambda\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Micronaut\",\"AWS Lambda\",\"AWS\",\"Native Image\",\"Java\"],image:\"micronaut-jpa-aws-lambda-function/cover.jpg\",\"photo-credits\":null,\"applaud-link\":\"micronaut-jpa-aws-lambda-function.json\",date:\"2021-07-29\",draft:!1,summary:\"In this article, we would be looking into some performance statistics when running a Micronaut Application on a JVM runtime versus a Native image on AWS Lambda function\",imageUrl:\"/static/images/2021/micronaut-jpa-aws-lambda-function/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(t,{})})):t();function t(){let e=Object.assign({p:\"p\",h3:\"h3\",a:\"a\",span:\"span\",code:\"code\",pre:\"pre\",div:\"div\",strong:\"strong\"},a.components),{Image:c}=e;return c||y(\"Image\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"In this article, I would be talking about the performance statistics when running a Micronaut Application on a JVM runtime versus running it as a Native image on the Lambda.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"introduction\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#introduction\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Micronaut became quite popular for their quick startup time because of the Ahead Of Time(AOT) compilation. It provides literally all the capabilities that SpringBoot provides like Aspect-Oriented programming, Dependency injection, etc.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now I have described how to create a Micronaut Application in my previous article \\u201C\",(0,n.jsx)(e.a,{href:\"https://refactorfirst.com/springboot-developers-guide-to-micronaut.html\",children:\"A SpringBoot Developer\\u2019s Guide to Micronaut\"}),\"\\u201D. I have also described how you can boost your application performance in another article \\u201C\",(0,n.jsx)(e.a,{href:\"https://refactorfirst.com/boost-java-application-performance-with-micronaut.html\",children:\"Boot Java Application Performance with Micronaut Native Image\"}),\"\\u201D.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Today we would be looking at how we can create an AWS Lamda function with Micronaut and see its performance statistics when we deploy it on JVM runtime and as a Native Image on Amazon Linux custom runtime image.\"}),`\n`,(0,n.jsx)(e.p,{children:\"So let\\u2019s get started.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"micronaut-function-on-aws-lambda\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#micronaut-function-on-aws-lambda\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Micronaut Function On AWS Lambda\"]}),`\n`,(0,n.jsx)(e.p,{children:\"In this, we would be creating a Micronaut function that takes an Order, persists on AWS RDS, and then returns the created ID.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can generate an application from \",(0,n.jsx)(e.a,{href:\"https://micronaut.io/launch\",children:\"Micronaut\\u2019s launch\"}),\". Here you select the application type as \\u201CFunction Application For Serverless\\u201D and in the features, add \\u201CHibernate-JPA\\u201D and \\u201CAWS-Lambda\\u201D.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Once you open the generated project, We will create our function handler by extending Micronaut\\u2019s Request handler \",(0,n.jsx)(e.code,{children:\"MicronautRequestHandler\"}),\" and override the \",(0,n.jsx)(e.code,{children:\"execute\"}),\" method.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Introspected\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OrderRequestHandler\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MicronautRequestHandler\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Inject\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OrderRepository\"}),\" orderRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Override\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"execute\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),\" input\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),\" saved \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"orderRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"save\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"input\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" saved\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"The repository is a simple JPA repository as follows.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Repository\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OrderRepository\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"JpaRepository\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Long\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"Micronaut code\",src:\"/static/images/2021/micronaut-jpa-aws-lambda-function/code.png\",width:\"360\",height:\"246\"})}),`\n`,(0,n.jsx)(e.p,{children:\"In the application.yml file, add data source properties to communicate with the AWS RDS instance.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-properties\",children:(0,n.jsxs)(e.code,{className:\"language-properties code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"datasources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"  default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"jdbc:mysql://database.whgnes.eu-central1.rds.amazonaws.com:3306/ORDERS_DB?characterEncoding=UTF-8\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    username\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"admin\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    password\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"nopass\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    driverClassName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"com.mysql.cj.jdbc.Driver\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"jpa\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"  default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    properties\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"      hibernate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"        hbm2ddl\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"          auto\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"update\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"        show_sql\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"        dialect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"org.hibernate.dialect.MySQL8Dialect\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"With this, we can start creating a jar using \",(0,n.jsx)(e.code,{children:\"mvn clean package\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next, we will create an AWS Lambda function with the runtime as Java 11, upload the jar, and set the handler function to \",(0,n.jsx)(e.code,{children:\"com.amrut.prabhu.OrderRequestHandler\"}),\".\"]}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"Micronaut AWS Function\",src:\"/static/images/2021/micronaut-jpa-aws-lambda-function/micronaut-aws-function.png\",width:\"473\",height:\"480\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s test this with the following payload.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-json\",children:(0,n.jsxs)(e.code,{className:\"language-json code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"body\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"{\\\\\"name\\\\\":\\\\\"Order from Lambda\\\\\"}\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here are the statistics I got with the Lamba configured with 512 MB ram.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"statistics\",src:\"/static/images/2021/micronaut-jpa-aws-lambda-function/statistics.png\",width:\"808\",height:\"109\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Now, this was what we got from the Lambda using the JVM runtime. Let\\u2019s look at improving this by creating a native image.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"aws-lambda-with-native-image-using-graalvm\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#aws-lambda-with-native-image-using-graalvm\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"AWS Lambda with Native Image Using GraalVM\"]}),`\n`,(0,n.jsx)(e.p,{children:\"To support creating the native image, we would have to do some changes to the code above.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Firstly, you will need to add a dependency to support creating the native image for the AWS lambda function\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-xml\",children:(0,n.jsxs)(e.code,{className:\"language-xml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"dependency\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"groupId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"io.micronaut.aws\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"groupId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"artifactId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"micronaut-function-aws-custom-runtime\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"artifactId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"scope\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"compile\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"scope\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"dependency\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next, You will need to create a custom initializer by extending \",(0,n.jsx)(e.code,{children:\"AbstractMicronautLambdaRuntime\"}),\" .\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OrderLambdaRuntime\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AbstractMicronautLambdaRuntime\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"APIGatewayProxyRequestEvent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"APIGatewayProxyResponseEvent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OrderLambdaRuntime\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MalformedURLException\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"printStackTrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Override\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Nullable\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"protected\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"RequestHandler\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"createRequestHandler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" args\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OrderRequestHandler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"In addition to this, You will need to set the main class in the properties section of your pom.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-xml\",children:(0,n.jsx)(e.code,{className:\"language-xml code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"exec.mainClass\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"com.amrut.prabhu.OrderLambdaRuntime\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"exec.mainClass\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"With this, you are done with your code changes.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next, To create the naive image, You need to set your default JDK to \",(0,n.jsx)(e.a,{href:\"https://www.graalvm.org/\",children:\"GraalVM\"}),\" JDK. I have used GraalVM CE 21.1.0 (build 11.0.11). You can easily install this using \",(0,n.jsx)(e.a,{href:\"https://sdkman.io/\",children:\"SDKMan\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Now let\\u2019s build the native image using the following command. Make sure you also have docker installed, as it makes use of the docker to download the AWS runtime image to build the native image.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"./mvnw clean package -Dpackaging\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"docker-native -Dmicronaut.runtime\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`lambda\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Creating the native image might take some time, Maybe around 3\\u20135mins depending on the system. The output is a zip file that contains the required bootstrap files to start the application.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Once created, Let\\u2019s upload the zip and set the runtime to the custom runtime option \\u201CProvide your own bootstrap on Amazon Linux 2\\u201D. In the case of the handler function, It doesn\\u2019t matter if you do not set it, as the Lambda would use your native image bootstrap file to start the application.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"Micronaut AWS function native image\",src:\"/static/images/2021/micronaut-jpa-aws-lambda-function/micronaut-aws-function-native.png\",width:\"394\",height:\"438\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Now, On invoking the function with the same payload as above, we get a huge change in the performance.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The init duration is now reduced to \",(0,n.jsx)(e.strong,{children:\"761 ms\"}),\". The execution time during the cold start remains the same i.e 1215 ms. But for subsequent calls, The response time is less than half of the previous results ie. \",(0,n.jsx)(e.strong,{children:\"14 ms\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Here are the statistics to compare between using a JVM runtime and the native image.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"Micronaut AWS function Native Image statistics\",src:\"/static/images/2021/micronaut-jpa-aws-lambda-function/micronaut-aws-function-native-image-statistics.png\",width:\"788\",height:\"245\"})}),`\n`,(0,n.jsx)(e.p,{children:\"So as you can see, we can achieve really high performance by building and using a native image.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can have a look at the code on my \",(0,n.jsx)(e.a,{href:\"https://github.com/amrutprabhu/micronaut-workout/tree/master/micronaut-lambda-function\",children:\"GitHub repo\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"next\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#next\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Next..\"]}),`\n`,(0,n.jsxs)(e.p,{children:['Now, In this article, we used a single function to add an object to the RDS database. But what about cases wherein you would want to add as well as retrieve an object. For this, We will be looking into deploying a Micronaut application on AWS Lambda providing PUT and GET capabilities and see its performance. You can read this in my next article \"',(0,n.jsx)(e.a,{href:\"/micronaut-aws-lambda-application-for-api-gateway.html\",children:\"Micronaut JPA Application Performance on AWS Lambda\"}),'\"']}),`\n`,(0,n.jsx)(e.p,{children:\"You can subscribe to my newsletter to get an email when I publish my articles\"})]})}}var v=f;function y(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return x;})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":3},{"value":"Micronaut Function On AWS Lambda","url":"#micronaut-function-on-aws-lambda","depth":3},{"value":"AWS Lambda with Native Image Using GraalVM","url":"#aws-lambda-with-native-image-using-graalvm","depth":3},{"value":"Next..","url":"#next","depth":3}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.21,"time":372600,"words":1242},"slug":"2020/micronaut-jpa-aws-lambda-function","fileName":"2020/micronaut-jpa-aws-lambda-function.md","title":"Micronaut JPA Function Performance on AWS Lambda","author":"Amrut Prabhu","categories":"","tags":["Micronaut","AWS Lambda","AWS","Native Image","Java"],"image":"micronaut-jpa-aws-lambda-function/cover.jpg","photo-credits":null,"applaud-link":"micronaut-jpa-aws-lambda-function.json","date":"2021-07-29T00:00:00.000Z","draft":false,"summary":"In this article, we would be looking into some performance statistics when running a Micronaut Application on a JVM runtime versus a Native image on AWS Lambda function","imageUrl":"/static/images/2021/micronaut-jpa-aws-lambda-function/cover.jpg","actualUrl":"2020/micronaut-jpa-aws-lambda-function","customUrl":"micronaut-jpa-aws-lambda-function"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"address@yoursite.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Boost Java Application Performance With Micronaut Native Image","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Micronaut","Native Image","Java"],"image":"micronaut-native-image-graalvm/micronaut-native-image-graalvm.jpg","photo-credits":null,"applaud-link":"boost-java-application-performance-with-micronaut.json","date":"2021-07-22T00:00:00.000Z","draft":false,"summary":"In this article, we would see how we can achieve an incredibly quick start-up time for a Java application","imageUrl":"/static/images/2021/micronaut-native-image-graalvm/micronaut-native-image-graalvm.jpg","actualUrl":"2020/boost-java-application-performance-with-micronaut","customUrl":"boost-java-application-performance-with-micronaut","slug":"boost-java-application-performance-with-micronaut"},"next":{"title":"Micronaut JPA Application Performance on AWS Lambda","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Micronaut","AWS","AWS Lambda","Native Image","Java"],"image":"micronaut-lambda-application/cover.jpg","photo-credits":null,"applaud-link":"micronaut-aws-lambda-application-for-api-gateway.json","date":"2021-08-12T00:00:00.000Z","draft":false,"summary":"In this article, we would be looking into how we can deploy a Micronaut application providing GET, PUT and POST which can be called using an API Gateway and check its performance","imageUrl":"/static/images/2021/micronaut-lambda-application/cover.jpg","actualUrl":"2020/micronaut-aws-lambda-application-for-api-gateway","customUrl":"micronaut-aws-lambda-application-for-api-gateway","slug":"micronaut-aws-lambda-application-for-api-gateway"}},"__N_SSG":true}