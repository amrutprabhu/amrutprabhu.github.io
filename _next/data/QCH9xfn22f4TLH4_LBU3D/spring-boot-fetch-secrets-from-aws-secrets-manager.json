{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!u.call(a,e)&&e!==\"default\"&&l(a,e,{get:()=>s[e],enumerable:!(c=d(s,e))||c.enumerable});return a},w=a=>g(i(l(a!=null?p(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((A,o)=>{o.exports=_jsx_runtime});var v={};k(v,{default:()=>S,frontmatter:()=>y});var n=w(r()),y={title:\"How to Fetch Database Secrets From AWS Secrets Manager in a Spring Boot Application\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Java\",\"Spring Boot\",\"Spring Cloud\",\"AWS\",\"Database\",\"Secrets Manager\"],\"photo-credits\":null,\"applaud-link\":\"2021/spring-boot-stream-kafka.json\",date:\"2022-09-22\",draft:!1,summary:\"In this article we will look into how we can fetch secrets from AWS Secrets Manager in a Spring Boot Application.\",imageUrl:\"/static/images/2022/spring-boot-aws-secrets-manager/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",div:\"div\",strong:\"strong\",em:\"em\"},a.components),{Image:t}=e;return t||b(\"Image\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"In this article, we will look into how we can fetch database secrets from the AWS Secrets Manager in a Spring Boot application to communicate with a database. Once we do that, we will then start a LocalStack instance to mimic the real AWS Secrets Manager service and make our application load secrets offline without communicating with the real AWS Secrets Manager service. Lastly, we will write an integration test using Testcontainers.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-a-spring-boot-application\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-a-spring-boot-application\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating a Spring Boot Application\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let\\u2019s go to \",(0,n.jsx)(e.a,{href:\"https://start.spring.io\",children:\"https://start.spring.io\"}),\" and create an application with the following dependencies.\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Spring Boot Starter Web (only required for REST endpoints)\"}),`\n`,(0,n.jsx)(e.li,{children:\"Spring Boot Starter Actuator (only to visualize the loaded properties)\"}),`\n`,(0,n.jsx)(e.li,{children:\"Spring Boot Starter Data JPA (for database communication)\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Next, we will use the Spring Cloud AWS Secrets Manager dependency to fetch our secrets. Currently, it's not yet released for general use but we will use the M2 version as of now.\"}),`\n`,(0,n.jsx)(e.p,{children:\"For this, we will use the Spring Cloud AWS dependency management to take care of our dependency versions.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-xml\",children:(0,n.jsxs)(e.code,{className:\"language-xml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"dependencyManagement\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"dependencies\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"dependency\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"         \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"groupId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"io.awspring.cloud\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"groupId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"         \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"artifactId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"spring-cloud-aws-dependencies\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"artifactId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"         \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"version\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"3.0.0-M2\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"version\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"         \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"type\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"pom\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"type\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"         \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"scope\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"import\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"scope\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"dependency\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"dependencies\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"dependencyManagement\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Next, we will add the following dependency\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-xml\",children:(0,n.jsxs)(e.code,{className:\"language-xml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"dependency\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"groupId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"io.awspring.cloud\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"groupId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"artifactId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"spring-cloud-aws-starter-secrets-manager\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"artifactId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"dependency\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"With this, let's create some secrets on the AWS Secrets Manager\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-secrets-on-aws-secrets-manager\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-secrets-on-aws-secrets-manager\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating Secrets on AWS Secrets Manager\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's create a secret using the AWS CLI configured in the system. In case you have not installed it, you can install it from \",(0,n.jsx)(e.a,{href:\"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html\",children:\"here\"}),\" or you can also create the secret using the AWS console UI.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsx)(e.code,{className:\"language-shell code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"aws secretsmanager create-secret --name /secret/db-credential --secret-string \",(0,n.jsx)(e.span,{className:\"token string\",children:`'{\"dbuser\": \"user1\", \"dbpassword\": \"password\"}'`}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"With this, we will have a secret created with two key-value pairs as shown below.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"AWS secret\",src:\"/static/images/2022/spring-boot-aws-secrets-manager/aws-secret.png\",width:\"637\",height:\"276\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-jpa-model-class\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-jpa-model-class\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating JPA Model Class\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's create a simple domain model class and a JPA repository as follows.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Table\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"model\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Entity\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Model\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Id\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Integer\"}),\" id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Column\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),\" name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//ommited getters and setters from here\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ModelRepository\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"JpaRepository\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Model\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Next, we will create simple REST endpoints to fetch and store data.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@RestController\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"WebController\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Autowired\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ModelRepository\"}),\" modelRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@GetMapping\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ResponseEntity\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ResponseEntity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ok\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"modelRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findAll\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@PostMapping\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ResponseEntity\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"save\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@RequestBody\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Model\"}),\" model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ResponseEntity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ok\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"modelRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"save\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"aws-secrets-manager-configuration\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#aws-secrets-manager-configuration\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"AWS Secrets Manager Configuration\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"In the \",(0,n.jsx)(e.code,{children:\"application.yaml\"}),\" we will add the following properties.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# actuator configuration\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"management\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"endpoints\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"web\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"exposure\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"include\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` env\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"spring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"datasource\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" jdbc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"mysql\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//localhost\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`3306/database\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"username\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"dbuser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"password\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"dbpassword\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"jpa\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"hibernate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"ddl-auto\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` create\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#  AWS configuration\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"cloud\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"aws\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"secretsmanager\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"region\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" eu\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"central\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"credentials\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"profile\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` personal\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"config\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"import\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" aws\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"secretsmanager\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"/secret/db\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`credential\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" optional\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"aws\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"secretsmanager\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"/secrets/optional\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`secret\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Firstly, we have configured management endpoints to show the application\\u2019s environment properties. We will use this endpoint to see what secret values got loaded.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now, we have two placeholder properties called \",(0,n.jsx)(e.code,{children:\"dbuser\"}),\" and \",(0,n.jsx)(e.code,{children:\"dbpassword\"}),\" which match exactly the keys in the secret we created on Secrets Manager.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Next, to communicate with AWS, we are going to be using the AWS profile credentials mechanism.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I have my AWS CLI configured with the AWS credentials under the profile called \\u201Cpersonal\\u201D and we will be using this profile to communicate with AWS. There are quite a few ways of communicating with AWS and you can find them \",(0,n.jsx)(e.a,{href:\"https://docs.awspring.io/spring-cloud-aws/docs/3.0.0-SNAPSHOT/reference/html/index.html#credentials\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Finally, we specify the secrets we want to fetch from the Secrets Manager under the \",(0,n.jsx)(e.code,{children:\"spring.config.import\"}),\" property. To indicate the secrets are needed to be fetched from AWS Secrets Manager, we have to specify \",(0,n.jsx)(e.code,{children:\"aws-secretsmanager\"}),\" before the list of secrets to be fetched.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"By default, the application needs access to the secrets on startup or the startup would fail. You can always specify an optional label to allow the application to start without failing if the secret does not exist, just as we did for the secret\",(0,n.jsx)(e.code,{children:\"/secret/optional-secret\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"With this, let's start the application.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The application starts up pulling the secrets from Secrets Manager and the values of the \",(0,n.jsx)(e.code,{children:\"dbuser\"}),\" and \",(0,n.jsx)(e.code,{children:\"dbpassword\"}),\" keys are used to communicate with the database.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now on accessing the actuator endpoint \",(0,n.jsx)(e.code,{children:\"http://localhost:8080/actuator/env\"}),\" , we see the properties that are loaded from Secrets Manager.\"]}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"secrets property view\",src:\"/static/images/2022/spring-boot-aws-secrets-manager/secret-property-view.png\",width:\"637\",height:\"276\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Now, let\\u2019s make some REST requests to store and fetch data from our database.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"sample post request\",src:\"/static/images/2022/spring-boot-aws-secrets-manager/sample-post-request.png\",width:\"683\",height:\"392\"})}),`\n`,(0,n.jsx)(e.p,{children:\"With this, we were able to pull the secrets from the AWS Secrets Manager, view the loaded secrets using actuator endpoints, and communicate with the database to store and fetch data.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now, let's see how we can do the same with LocalStack.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"loading-secrets-from-localstack\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#loading-secrets-from-localstack\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Loading Secrets from LocalStack\"]}),`\n`,(0,n.jsx)(e.p,{children:\"To load secrets from LocalStack, we will use the docker version of LocalStack and run it using a docker-compose file.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"version\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'3.8'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"services\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"localstack\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` localstack/localstack\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"ports\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'4566:4566'\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# LocalStack endpoint\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"environment\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" DOCKER_HOST=unix\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`///var/run/docker.sock\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" DEFAULT_REGION=eu\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"central\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"volumes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" ./localstack\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"script\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"/docker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"entrypoint\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`initaws.d\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" /var/run/docker.sock\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`/var/run/docker.sock\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here we are mounting a local volume that contains an init script for creating the secrets in LocalStack. This init script makes use of the \",(0,n.jsx)(e.code,{children:\"awslocal\"}),\" command which is a wrapper around the AWS CLI inside LocalStack. We then give it the same command options that we used before to create the secret on AWS Secrets Manager but this time we use the command \",(0,n.jsx)(e.code,{children:\"awslocal\"}),\" provided by LocalStack.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsx)(e.code,{className:\"language-shell code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"awslocal secretsmanager create-secret --name /secret/db-credential --secret-string \",(0,n.jsx)(e.span,{className:\"token string\",children:`'{\"dbuser\": \"user1\", \"dbpassword\": \"password\"}'`}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Next, we will have to configure the LocalStack URL in our properties file as shown below.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"Spring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"cloud\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"aws\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"secretsmanager\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"region\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" eu\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"central\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"endpoint\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//localhost\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4566\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"credentials\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"access-key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` none\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"secret-key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` none\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"LocalStack does not require any credentials to communicate with it. But to work with the AWS client, the client needs a secret and access key values. Hence we provide any random value for the secret and access key.\"}),`\n`,(0,n.jsx)(e.p,{children:\"With this, you can now communicate with LocalStack and fetch secrets from LocalStack.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"integration-test-with-localstack\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#integration-test-with-localstack\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Integration Test with LocalStack\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Every application that you develop needs to have some tests, so you can evolve your application without breaking it.\"}),`\n`,(0,n.jsx)(e.p,{children:\"So let\\u2019s write an Integration test that will start the application by pulling secrets from Localstack using Testcontainers and then store and retrieve data from our database. We will also start the database using Testcontainers.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s look at the test setup we need.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@SpringBootTest\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@AutoConfigureMockMvc\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ApplicationIT\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Autowired\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MockMvc\"}),\" mockMvc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Container\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"LocalStackContainer\"}),\" localStackContainer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"LocalStackContainer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DockerImageName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"parse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"localstack/localstack\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"           \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withCopyFileToContainer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MountableFile\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"forClasspathResource\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"script.sh\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/docker-entrypoint-initaws.d/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withServices\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"LocalStackContainer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Service\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SECRETSMANAGER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Container\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MySQLContainer\"}),\" database \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MySQLContainer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DockerImageName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"parse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"mysql/mysql-server:5.7\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asCompatibleSubstituteFor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"mysql\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withDatabaseName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"database\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withUsername\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"user1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withPassword\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"password\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here we start the two Testcontainers, LocalStackContainer and MySQLcontainer.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The LocalStackContainer has an instruction to copy an init script to the \",(0,n.jsx)(e.code,{children:\"docker-entrypoint-initaws.d\"}),\" folder which will create the secret in LocalStack. It's the same script we had seen above while starting the docker-compose file.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Next, we have the MySQLContainer with a database name, a user, and a password configured for the database.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now let\\u2019s initialize the properties with values from Testcontainers.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@BeforeAll\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"beforeAll\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"IOException\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"InterruptedException\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"setProperty\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"spring.cloud.aws.secretsmanager.endpoint\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" localStackContainer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getEndpointOverride\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"LocalStackContainer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Service\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SECRETSMANAGER\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"toString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"setProperty\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"spring.cloud.aws.secretsmanager.region\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" localStackContainer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getRegion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"setProperty\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"spring.cloud.aws.credentials.access-key\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"none\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"System\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"setProperty\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"spring.cloud.aws.credentials.secret-key\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"none\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@DynamicPropertySource\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"properties\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DynamicPropertyRegistry\"}),\" registry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    registry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"spring.datasource.url\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" database\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getJdbcUrl\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here, we use the \",(0,n.jsx)(e.code,{children:\"@DynamicPropertySource\"}),\" to bind the properties for the database URL and we use \",(0,n.jsx)(e.code,{children:\"@BeforeAll\"}),\" , to set the properties for the LocalStackContainer.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:(0,n.jsxs)(e.em,{children:[\"So why are using \",(0,n.jsx)(e.code,{children:\"@BeforeAll\"}),\" and not \",(0,n.jsx)(e.code,{children:\"@DynamicPropertySource\"}),\" to set the property values for LocalStack?\"]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"This is because \",(0,n.jsx)(e.code,{children:\"@DynamicPropertySource\"}),\" does not work with Spring config import. If you set the AWS credentials properties using \",(0,n.jsx)(e.code,{children:\"@DynamicPropertySource\"}),\" , they get loaded after the application is initialized and the application does not communicate with LocalStack. You can read about this issue \",(0,n.jsx)(e.a,{href:\"https://github.com/spring-projects/spring-boot/issues/26148\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"So the best option, for now, is to set the properties using \",(0,n.jsx)(e.code,{children:\"System.setProperty\"}),\" .\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Finally, we will run the test and check if the application starts up, fetches secret values, and then make REST calls to save and fetch data.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Test\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"testApplicationLoadsAndServesRequests\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//Given\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Model\"}),\" model \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Model\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"setId\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"setName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//when\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    mockMvc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"perform\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MockMvcRequestBuilders\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"post\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"contentType\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MediaType\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"APPLICATIONJSON\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"content\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ObjectMapper\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"writeValueAsString\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//then\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"andExpect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MockMvcResultMatchers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"isOk\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"andExpect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonPath\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"$.id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Matchers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"is\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"andExpect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonPath\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"$.name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Matchers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"is\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//when\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    mockMvc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"perform\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MockMvcRequestBuilders\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//then\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"andExpect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MockMvcResultMatchers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"isOk\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"andExpect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonPath\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"$.[0].id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Matchers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"is\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"andExpect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"jsonPath\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"$.[0].name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Matchers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"is\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Now, this is just one of the ways that you can test your code.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you want to learn how you can write good and reliable tests and want to master your skills in writing tests, I would highly recommend the course \\u201C\",(0,n.jsx)(e.a,{href:\"https://transactions.sendowl.com/stores/13745/235788\",children:\"Testing Spring Boot Application Masterclass\"}),\"\\u201D by \",(0,n.jsx)(e.a,{href:\"https://twitter.com/rieckpil\",children:\"Philip Riecks\"}),\".\"]}),`\n`,(0,n.jsx)(\"a\",{href:\"https://transactions.sendowl.com/stores/13745/235788\",target:\"_blank\",children:(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"\",src:\"/static/images/2022/spring-boot-testing-masterclass/testing-spring-boot-applications-masterclass.png\",width:\"600\",height:\"600\"})})}),`\n`,(0,n.jsx)(e.p,{children:\"This course provides you with a comprehensive guide on how you can start and grow your knowledge on writing effective tests for your Spring Boot application.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"conclusion\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#conclusion\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,n.jsx)(e.p,{children:\"We just saw how we can fetch database credentials from AWS Secrets manager using Spring Cloud AWS Secrets Manager. We then looked at how we can work with LocalStack to fetch secrets and also wrote an integration test using Testcontainers.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The entire code is uploaded to my GitHub repo \",(0,n.jsx)(e.a,{href:\"https://github.com/amrutprabhu/spring-boot-with-secrets-manager\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I keep exploring and learning new things. If you want to know the latest trends and improve your software development skills, then subscribe to my newsletter below and also follow me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/amrutprabhu42\",children:\"Twitter\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Enjoy!!\"})]})}}var S=f;function b(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return v;})();\n;return Component;","toc":[{"value":"Creating a Spring Boot Application","url":"#creating-a-spring-boot-application","depth":2},{"value":"Creating Secrets on AWS Secrets Manager","url":"#creating-secrets-on-aws-secrets-manager","depth":2},{"value":"Creating JPA Model Class","url":"#creating-jpa-model-class","depth":2},{"value":"AWS Secrets Manager Configuration","url":"#aws-secrets-manager-configuration","depth":2},{"value":"Loading Secrets from LocalStack","url":"#loading-secrets-from-localstack","depth":2},{"value":"Integration Test with LocalStack","url":"#integration-test-with-localstack","depth":2},{"value":"Conclusion","url":"#conclusion","depth":2}],"frontMatter":{"readingTime":{"text":"12 min read","minutes":11.765,"time":705900,"words":2353},"slug":"2022/spring-boot-fetch-secrets-from-aws-secrets-manager","fileName":"2022/spring-boot-fetch-secrets-from-aws-secrets-manager.md","title":"How to Fetch Database Secrets From AWS Secrets Manager in a Spring Boot Application","author":"Amrut Prabhu","categories":"","tags":["Java","Spring Boot","Spring Cloud","AWS","Database","Secrets Manager"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-09-22T00:00:00.000Z","draft":false,"summary":"In this article we will look into how we can fetch secrets from AWS Secrets Manager in a Spring Boot Application.","imageUrl":"/static/images/2022/spring-boot-aws-secrets-manager/cover.jpg","actualUrl":"2022/spring-boot-fetch-secrets-from-aws-secrets-manager","customUrl":"spring-boot-fetch-secrets-from-aws-secrets-manager"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Spring Boot Application Testing Masterclass Course Review","author":"Amrut Prabhu","categories":"","tags":["Java","Spring Boot","Testing","Course"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-09-15T00:00:00.000Z","draft":false,"summary":"This article is about my thoughts on using the Spring Boot Application Testing Masterclass course from rieckpil.de","imageUrl":"/static/images/2022/spring-boot-testing-masterclass/cover.png","actualUrl":"2022/spring-boot-application-testing-masterclass-course-review","customUrl":"spring-boot-application-testing-masterclass-course-review","slug":"spring-boot-application-testing-masterclass-course-review"},"next":{"title":"Implementing GraphQL APIs in a Spring Boot Application","author":"Amrut Prabhu","categories":"","tags":["Java","Spring Boot","GraphQL"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-09-29T00:00:00.000Z","draft":false,"summary":"In this article, we will look into defining a GraphQL schema, implement APIs and write integration tests.","imageUrl":"/static/images/2022/spring-boot-with-graphql/cover.jpg","actualUrl":"2022/spring-boot-with-graphql","customUrl":"spring-boot-with-graphql","slug":"spring-boot-with-graphql"}},"__N_SSG":true}