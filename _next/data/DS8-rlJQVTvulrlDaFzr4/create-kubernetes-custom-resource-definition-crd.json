{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var i=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var l=a=>i(a,\"__esModule\",{value:!0});var k=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{l(a);for(var t in s)i(a,t,{get:s[t],enumerable:!0})},y=(a,s,t)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)&&n!==\"default\"&&i(a,n,{get:()=>s[n],enumerable:!(t=h(s,n))||t.enumerable});return a},g=a=>y(l(i(a!=null?d(u(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=k((R,r)=>{r.exports=_jsx_runtime});var C={};N(C,{default:()=>f,frontmatter:()=>b});var e=g(o()),b={title:\"Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Kubernetes\",\"yaml\",\"Docker\"],\"photo-credits\":null,\"applaud-link\":\"2021/spring-boot-stream-kafka.json\",date:\"2022-07-07\",draft:!1,summary:\" In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)\",imageUrl:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",div:\"div\",code:\"code\",ul:\"ul\",li:\"li\",br:\"br\",pre:\"pre\",strong:\"strong\",h3:\"h3\"},a.components),{Image:c}=n;return c||v(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"This is a multi-part article on how you can create a Kubernetes Custom Resource Definition (CRD) and then create a Kubernetes controller to handle CRD instance creation requests. In this article, we would be exploring how we can create your own Kubernetes CRD.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"understanding-how-kubernetes-works-with-resources\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#understanding-how-kubernetes-works-with-resources\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding How Kubernetes Works with Resources\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Before we move on to creating our first CRD and controller, we have to understand some concepts behind how Kubernetes resource management works.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s look at the diagram\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Kubernetes working\",src:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/kubernetes-working.png\",width:\"1187\",height:\"609\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"As you see in the diagram, we have an API server, scheduler, controller, and database. When we use the command \",(0,e.jsx)(n.code,{children:\"kubectl\"}),\" to create a resource, we are actually talking to the API server and the API server merely stores the resource in the database. Now, we have a scheduler, which keeps on asking the API server if there are some resources created.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Once the scheduler finds that a pod has to be created, it then inserts into the database via the API server the reference of the node where the pod will be created.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Next, Kubelets running on the various worker nodes start calling the API server and check if any pods have to be created on that particular node. Kubelets are nothing but controllers themselves.\"}),`\n`,(0,e.jsx)(n.p,{children:\"So in this article, we will see how you can create your own Kubernetes CRD, and then create an instance of the CRD.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"pre-requisites\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#pre-requisites\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Pre-requisites\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"A working Kubernetes cluster. (local or remote)\",(0,e.jsx)(n.br,{}),`\n`,\"If you don't have one, you can always run a \",(0,e.jsx)(n.a,{href:\"https://k3s.io/\",children:\"K3s\"}),\" cluster locally or you can use a Kind Kubernetes cluster. You can read about starting a Kind Kubernetes cluster \",(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/kind-kubernetes-cluster\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsx)(n.li,{children:\"Basic knowledge of working with \\u201CKubectl\\u201D commands to create, get or delete a resource.\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"creating-a-kubernetes-custom-resource-definition-crd\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-a-kubernetes-custom-resource-definition-crd\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating a Kubernetes Custom Resource Definition (CRD)\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's create a simple Kubernetes Custom Resource Definition and view its various parts.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apiextensions.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` CustomResourceDefinition\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crds.com.amrut.prabhu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"group\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` com.amrut.prabhu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"names\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"plural\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crds\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"scope\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Namespaced\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"versions\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"served\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"storage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"schema\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"openAPIV3Schema\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"my-own-property\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"This is the most minimalistic definition to create your own Kubernetes CRD.\"}),`\n`,(0,e.jsx)(n.p,{children:\"To understand this, Let\\u2019s break it up into two parts.\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Part 1\"}),\": Define the metadata and definition of the CRD\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Part 2\"}),\": Define the schema of the CRD instances that we will create later.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"understanding-the-kubernetes-custom-resource-definition-format\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#understanding-the-kubernetes-custom-resource-definition-format\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding The Kubernetes Custom Resource Definition Format\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's Look at Part 1.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apiextensions.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` CustomResourceDefinition\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crds.com.amrut.prabhu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"group\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` com.amrut.prabhu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"names\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"plural\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crds\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"scope\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Namespaced\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"versions\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"served\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"storage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here we define the \\u201CKind\\u201D of our resource, i.e we want to create a CRD and we provide it a name. The name has to be of the format \",(0,e.jsx)(n.code,{children:\"<CRD plural Name>.<Group name>\"}),\" , ie. \\u201C\",(0,e.jsx)(n.code,{children:\"my-crds\"}),\" \",(0,e.jsx)(n.code,{children:\".\"}),\" \",(0,e.jsx)(n.code,{children:\"com.amrut.prabhu\"}),\" \\u201D. Next, in the \",(0,e.jsx)(n.code,{children:\"spec\"}),\" section, we define the name and the plural name of the kind we are creating. This is the type we will specify while creating a new instance later.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Next, we define that the CRD will be scoped to a namespace and in the version section, we specify the version of this CRD to \",(0,e.jsx)(n.code,{children:\"v1\"}),\". When we want to create a new version of this definition, we will just bump up this version number.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Lastly, we have \",(0,e.jsx)(n.code,{children:\"served\"}),\" property that defines if this CRD is enabled to be used in the cluster and \",(0,e.jsx)(n.code,{children:\"storage\"}),\" refers to if this version of the CRD will be stored. At a time you can have only one version of the CRD that can be stored.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"This was all about defining our CRD. Let\\u2019s look at the schema of the CRD.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"understanding-crd-schema\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#understanding-crd-schema\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding CRD Schema\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"schema\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"openAPIV3Schema\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"my-own-property\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"In this, we define the schema using the Open API version 3 standards. We specify the top level as an object which has some properties.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now, some of the absolutely required properties are:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"apiVersion\"}),\": To define the version of the CRD we will be using.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"kind\"}),\": The type of the CRD\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"metadata\"}),\": The metadata which will be added such as the name, annotations, etc. This will be of the type Object.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"spec\"}),\": This defines the custom specifications properties you want to provide.\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, in the above schema, I have specified only one property i.e \",(0,e.jsx)(n.code,{children:\"my-own-property\"}),\" in the spec section. You can also define a property of type object having its own properties.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's look at how the CRD is mapped to our CRD instance.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"CRD to CRD instance Mapping\",src:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-to-instance-map.jpg\",width:\"1748\",height:\"1240\"})}),`\n`,(0,e.jsx)(n.p,{children:\"As you can see above, the arrows make it simple to understand which property from the CRD maps to the CRD instance. This is how our custom resource definition is mapped to the actual instance YAML file.\"}),`\n`,(0,e.jsx)(n.p,{children:\"With this, let's first apply our CRD to the Kubernetes cluster.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"adding-kubernetes-crd-to-the-kubernetes-cluster\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#adding-kubernetes-crd-to-the-kubernetes-cluster\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Adding Kubernetes CRD to the Kubernetes Cluster\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In order to use our CRD, We will have to add it to our Kubernetes Cluster. Let\\u2019s install this using the following command\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"language-shell code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`kubectl apply -f my-crd.yaml\n`})})}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"CRD apply\",src:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-apply.png\",width:\"1602\",height:\"548\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Now, after creating the CRD, we are going to create our first CRD instance. We will use the same instance YAML file from above.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` com.amrut.prabhu/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"custom\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"resource\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`instance\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"my-own-property\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'My first CRD instance'\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"CRD Instance Apply\",src:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-instance-apply.png\",width:\"1602\",height:\"388\"})}),`\n`,(0,e.jsx)(n.p,{children:\"With this, we just created our first Kubernetes CRD and then created our first CRD instance.\"}),`\n`,(0,e.jsx)(n.p,{children:\"After creating the instance nothing really happened. Only the instance object was created and stored in the Kubernetes database.\"}),`\n`,(0,e.jsx)(n.p,{children:\"But we want it to do something when we create an instance.\"}),`\n`,(0,e.jsx)(n.p,{children:\"For this, we will need to implement a controller that will handle creating instance requests and do something with it. We will explore this in our next article.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"You can find CRD yaml files on GitHub \",(0,e.jsx)(n.a,{href:\"https://github.com/amrutprabhu/kubernetes-custom-resource/tree/main/crd\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"So, subscribe to my newsletter below and follow me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/amrutprabhu42\",children:\"Twitter\"}),\" to know when the article is published.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Enjoy!!\"})]})}}var f=w;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return C;})();\n;return Component;","toc":[{"value":"Understanding How Kubernetes Works with Resources","url":"#understanding-how-kubernetes-works-with-resources","depth":2},{"value":"Pre-requisites","url":"#pre-requisites","depth":2},{"value":"Creating a Kubernetes Custom Resource Definition (CRD)","url":"#creating-a-kubernetes-custom-resource-definition-crd","depth":2},{"value":"Understanding The Kubernetes Custom Resource Definition Format","url":"#understanding-the-kubernetes-custom-resource-definition-format","depth":2},{"value":"Understanding CRD Schema","url":"#understanding-crd-schema","depth":3},{"value":"Adding Kubernetes CRD to the Kubernetes Cluster","url":"#adding-kubernetes-crd-to-the-kubernetes-cluster","depth":2}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.745,"time":404700,"words":1349},"slug":"2022/create-kubernetes-custom-resource-definition-crd","fileName":"2022/create-kubernetes-custom-resource-definition-crd.md","title":"Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)","author":"Amrut Prabhu","categories":"","tags":["Kubernetes","yaml","Docker"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-07-07T00:00:00.000Z","draft":false,"summary":" In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)","imageUrl":"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg","actualUrl":"2022/create-kubernetes-custom-resource-definition-crd","customUrl":"create-kubernetes-custom-resource-definition-crd"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"3 Ways to Create Spring Boot Docker Images Without DockerÂ File","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Java","Docker","Maven"],"image":"2022/spring-boot-prometheus-grafana/cover.jpg","photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-06-23T00:00:00.000Z","draft":false,"summary":" In this article, we would be looking into some of the ways to create docker images for a Spring Boot Application.","imageUrl":"/static/images/2022/3-ways-to-create-docker-images/cover.jpg","actualUrl":"2022/3-ways-to-create-spring-boot-docker-images","customUrl":"3-ways-to-create-spring-boot-docker-images","slug":"3-ways-to-create-spring-boot-docker-images"},"next":{"title":"Part 2: How to Create a Spring Boot Kubernetes Controller","author":"Amrut Prabhu","categories":"","tags":["Kubernetes","yaml","Docker"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-07-21T00:00:00.000Z","draft":false,"summary":" In this article, we learn how to create a Spring Boot based Kubernetes Controller and explore the various components needed to create it.","imageUrl":"/static/images/2022/create-kubernetes-controller-with-spring/cover.jpg","actualUrl":"2022/java-spring-boot-kubernetes-controller","customUrl":"java-spring-boot-kubernetes-controller","slug":"java-spring-boot-kubernetes-controller"}},"__N_SSG":true}