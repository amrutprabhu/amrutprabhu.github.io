{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var i=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var l=a=>i(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{l(a);for(var t in s)i(a,t,{get:s[t],enumerable:!0})},g=(a,s,t)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!u.call(a,e)&&e!==\"default\"&&i(a,e,{get:()=>s[e],enumerable:!(t=p(s,e))||t.enumerable});return a},w=a=>g(l(i(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((O,o)=>{o.exports=_jsx_runtime});var I={};k(I,{default:()=>b,frontmatter:()=>f});var n=w(r()),f={title:\"Micronaut JPA Application Performance on AWS Lambda\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Spring Boot\",\"Micronaut\",\"AWS\",\"AWS Lambda\",\"Native Image\",\"Java\"],image:\"micronaut-lambda-application/cover.jpg\",\"photo-credits\":null,\"applaud-link\":\"micronaut-aws-lambda-application-for-api-gateway.json\",date:\"2021-08-12\",draft:!1,summary:\"In this article, we would be looking into how we can deploy a Micronaut application providing GET, PUT and POST which can be called using an API Gateway and check its performance\",imageUrl:\"/static/images/2021/micronaut-lambda-application/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(t,{})})):t();function t(){let e=Object.assign({p:\"p\",h1:\"h1\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",div:\"div\",h2:\"h2\",strong:\"strong\"},a.components),{Image:c}=e;return c||v(\"Image\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"In this article, we would be looking into how we can deploy a Micronaut application providing GET, PUT and POST which can be called using an API Gateway. Then we would compare its performance when deployed with JVM runtime and as a native image.\"}),`\n`,(0,n.jsxs)(e.h1,{id:\"introduction\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#introduction\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),`\n`,(0,n.jsx)(e.p,{children:\"In this article, I would be focusing on creating the application that can be deployed on an AWS Lambda and then call the application as if it's being called using an API Gateway.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I have previously written an article \",(0,n.jsx)(e.a,{href:\"https://refactorfirst.com/micronaut-jpa-aws-lambda-function.html\",children:\"here\"}),\" which will help you to create a Micronaut function handler from scratch. I would recommend you to read it if you want to start from the beginning. If you want to skip it, you can use the code directly from my \",(0,n.jsx)(e.a,{href:\"https://github.com/amrutprabhu/micronaut-workout/tree/master/micronaut-lambda-function\",children:\"Github repo\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"With this let\\u2019s get started.\"}),`\n`,(0,n.jsxs)(e.h1,{id:\"code-modifications\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#code-modifications\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Code Modifications\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Now from the application you just created or got from the GitHub repo above, We would make some modifications to the code to start serving requests.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"We can apply a simple MVC pattern, wherein we can create a controller, a service that has some business logic and does the transformation from a DTO to a model, and then a repository to persist it. This pattern is totally optional to implement. You can also apply a Domain-Driven Design(DDD) pattern to structure your code. If you would like to see a simple DDD code structure pattern using Micronaut you can have a look at this \",(0,n.jsx)(e.a,{href:\"https://github.com/amrutprabhu/micronaut-workout/tree/master/MicronautApp\",children:\"GitHub repo\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"But we will keep things simple and call the repository directly from the controller, similar to our previous example wherein we called the repository from the handler function.\"}),`\n`,(0,n.jsx)(e.p,{children:\"So the first change we will do is delete two classes.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"OrderLambdaRuntime\"}),`\n`,(0,n.jsx)(e.li,{children:\"OrderRequestHandler\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"With this, we will be left with only the model and repository.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now, let's create our controller to handle the incoming request. I will create two methods, PUT to add orders and GET to get all the orders.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Validated\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Controller\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"WebController\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OrderRepository\"}),\" orderRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"WebController\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OrderRepository\"}),\" orderRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"orderRepository \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" orderRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/{id}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpResponse\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getOrder\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@PathVariable\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Long\"}),\" id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Optional\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" mayBeOrder \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"orderRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findById\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mayBeOrder\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"isPresent\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpResponse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"_created_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mayBeOrder\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpResponse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"_notFound_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Get\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpResponse\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getAllOrders\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpResponse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"_ok_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"orderRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getAllOrders\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Put\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpResponse\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"addOrder\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Body\"}),\" \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Valid\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),\" order\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Order\"}),\" savedOrder \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" orderRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"save\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"order\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpResponse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"_ok_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"savedOrder\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"AWS Lambda Code\",src:\"/static/images/2021/micronaut-lambda-application/code.png\",width:\"344\",height:\"239\"})}),`\n`,(0,n.jsx)(e.p,{children:\"We also would now change the database from MySQL to Postgres. For this, we would add the Postgres driver dependency and the corresponding connection string in the properties file.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-xml\",children:(0,n.jsxs)(e.code,{className:\"language-xml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"dependency\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"groupId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"org.postgresql\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"groupId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"artifactId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"postgresql\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"artifactId\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"version\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"42.2.18\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"version\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"dependency\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-properties\",children:(0,n.jsxs)(e.code,{className:\"language-properties code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"datasources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"  default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"jdbc:postgresql://database.ashdjsirje.eu-central-1.rds.amazonaws.com/orders_db?characterEncoding=UTF-8\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    username\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"postgres\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    password\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"nopass\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"    driverClassName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token attr-value\",children:\"org.postgresql.Driver\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"I had to switch to Postgres because the MySQL driver was unstable when using it in a native image. It could not deserialize the object properly when it was being fetched.\"}),`\n`,(0,n.jsx)(e.p,{children:\"With this, we are ready to build the application and deploy it on the Lambda JVM runtime\"}),`\n`,(0,n.jsxs)(e.h1,{id:\"deploying-with-jvm-runtime\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#deploying-with-jvm-runtime\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Deploying with JVM runtime.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let\\u2019s build the application using \",(0,n.jsx)(e.code,{children:\"mvn clean package\"}),\" , and then deploy it to an AWS Lambda using Java 11 runtime. Once created, set the handler function to a class provided by Micronaut i.e. \",(0,n.jsx)(e.code,{children:\"io.micronaut.function.aws.proxy.MicronautLambdaHandler\"}),\" . Now, this class comes from the dependency \",(0,n.jsx)(e.code,{children:\"micronaut-function-aws-api-proxy\"}),\" which we had already added previously.\"]}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"lambda function definition\",src:\"/static/images/2021/micronaut-lambda-application/lambda-function-application.png\",width:\"446\",height:\"485\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Once we are ready, We can then trigger the lambda in the test section using the following payload.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-json\",children:(0,n.jsxs)(e.code,{className:\"language-json code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"body\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"{\\\\\"name\\\\\":\\\\\"Order from Lambda application\\\\\"}\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"resource\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"path\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"httpMethod\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"PUT\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"We can now also retrieve the persisted orders by making a GET call as follows.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-json\",children:(0,n.jsxs)(e.code,{className:\"language-json code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"resource\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"path\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"httpMethod\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"GET\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Once you hook the lambda function with an API getaway, the input request is similar to the one we just sent to the function as an input.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now with this, let's look at the statistics I got for lambda configured with 512MB\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"AWS lamda function statistics \",src:\"/static/images/2021/micronaut-lambda-application/micronaut-aws-function-statistics.png\",width:\"788\",height:\"115\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s now look at improving the application performance by creating a Native image.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"deploying-native-image-on-aws-lambda-with-custom-runtime\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#deploying-native-image-on-aws-lambda-with-custom-runtime\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Deploying Native Image on AWS Lambda with Custom Runtime\"]}),`\n`,(0,n.jsx)(e.p,{children:\"To build the native image, we would use a GraalVM JDK. I have used GraalVM CE 21.1.0 (build 11.0.11) for Java 11.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Before building, we have to set one extra property in the pom.xml file. we need to set the main class.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-xml\",children:(0,n.jsx)(e.code,{className:\"language-xml code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"exec.mainClass\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"io.micronaut.function.aws.runtime.MicronautLambdaRuntime\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"exec.mainClass\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Now we can then run the following command to build the image.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"./mvnw clean package -Dpackaging\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"docker-native -Dmicronaut.runtime\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`lambda\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"It may take around 3\\u20135 minutes to build the zip file containing the native image depending on your system.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Next, let's create an AWS lambda function with the custom runtime option \\u201CProvide your own bootstrap on Amazon Linux 2\\u201D, and then upload the zip file.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"AWS Lambda function native image\",src:\"/static/images/2021/micronaut-lambda-application/micronaut-aws-function-native.png\",width:\"394\",height:\"438\"})}),`\n`,(0,n.jsx)(e.p,{children:\"This time you don\\u2019t need to set any handler function as the bootstrap file in the zip will start the application.\"}),`\n`,(0,n.jsx)(e.p,{children:\"You can now trigger the application with the same tests from above to persist an order or to get a list of orders.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"With native images, we get a significant improvement with the init time being only around \",(0,n.jsx)(e.strong,{children:\"932ms\"}),\" during cold start and the subsequent PUT requests came close to \",(0,n.jsx)(e.strong,{children:\"16ms\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Here are the statistics I got.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"AWS Lambda native image statistics\",src:\"/static/images/2021/micronaut-lambda-application/micronaut-aws-lambda-native-image-statistics.png\",width:\"703\",height:\"253\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"I have uploaded the code on \",(0,n.jsx)(e.a,{href:\"https://github.com/amrutprabhu/micronaut-workout/tree/master/micronaut-lamdba-application\",children:\"GitHub\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"With this, we are at the end of series of articles exploring Micronaut. But this is not the end. I would be exploring more frameworks and Micronaut will be on my radar for new features.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Stay tuned with new trends in frameworks and software development in general by subscribing to my newsletter to get updates on more such articles.\"})]})}}var b=y;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return I;})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":1},{"value":"Code Modifications","url":"#code-modifications","depth":1},{"value":"Deploying with JVM runtime.","url":"#deploying-with-jvm-runtime","depth":1},{"value":"Deploying Native Image on AWS Lambda with Custom Runtime","url":"#deploying-native-image-on-aws-lambda-with-custom-runtime","depth":2}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.49,"time":389400,"words":1298},"slug":"2020/micronaut-aws-lambda-application-for-api-gateway","fileName":"2020/micronaut-aws-lambda-application-for-api-gateway.md","title":"Micronaut JPA Application Performance on AWS Lambda","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Micronaut","AWS","AWS Lambda","Native Image","Java"],"image":"micronaut-lambda-application/cover.jpg","photo-credits":null,"applaud-link":"micronaut-aws-lambda-application-for-api-gateway.json","date":"2021-08-12T00:00:00.000Z","draft":false,"summary":"In this article, we would be looking into how we can deploy a Micronaut application providing GET, PUT and POST which can be called using an API Gateway and check its performance","imageUrl":"/static/images/2021/micronaut-lambda-application/cover.jpg","actualUrl":"2020/micronaut-aws-lambda-application-for-api-gateway","customUrl":"micronaut-aws-lambda-application-for-api-gateway"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"address@yoursite.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Micronaut JPA Function Performance on AWS Lambda","author":"Amrut Prabhu","categories":"","tags":["Micronaut","AWS Lambda","AWS","Native Image","Java"],"image":"micronaut-jpa-aws-lambda-function/cover.jpg","photo-credits":null,"applaud-link":"micronaut-jpa-aws-lambda-function.json","date":"2021-07-29T00:00:00.000Z","draft":false,"summary":"In this article, we would be looking into some performance statistics when running a Micronaut Application on a JVM runtime versus a Native image on AWS Lambda function","imageUrl":"/static/images/2021/micronaut-jpa-aws-lambda-function/cover.jpg","actualUrl":"2020/micronaut-jpa-aws-lambda-function","customUrl":"micronaut-jpa-aws-lambda-function","slug":"micronaut-jpa-aws-lambda-function"},"next":{"title":"Distributed Tracing with Spring Cloud Sleuth And Zipkin","author":"Amrut Prabhu","tags":["Spring Boot","Java","Distributed Tracing","Zipkin"],"photo-credits":"https://unsplash.com/photos/d9ILr-dbEdg","applaud-link":"2021/distributed-tracing-with-spring-zipkin.json","date":"2021-08-19T00:00:00.000Z","draft":false,"summary":"We would learn how we can implement distributed tracing in a Spring Boot Application and understand the key concepts of distributed tracing","imageUrl":"/static/images/2021/distributed-tracing-with-zipkin/cover.jpg","actualUrl":"2021/distributed-tracing-with-spring-cloud-sleuth","customUrl":"distributed-tracing-with-spring-cloud-sleuth","slug":"distributed-tracing-with-spring-cloud-sleuth"}},"__N_SSG":true}