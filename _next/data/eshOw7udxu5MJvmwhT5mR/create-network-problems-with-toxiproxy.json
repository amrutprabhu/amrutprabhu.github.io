{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var h=Object.create;var o=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var l=a=>o(a,\"__esModule\",{value:!0});var y=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),g=(a,s)=>{l(a);for(var t in s)o(a,t,{get:s[t],enumerable:!0})},w=(a,s,t)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of u(s))!k.call(a,e)&&e!==\"default\"&&o(a,e,{get:()=>s[e],enumerable:!(t=m(s,e))||t.enumerable});return a},x=a=>w(l(o(a!=null?h(N(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var p=y((P,r)=>{r.exports=_jsx_runtime});var T={};g(T,{default:()=>v,frontmatter:()=>f});var n=x(p()),f={title:\"Create Network Problems With Toxiproxy\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Java\",\"Spring Boot\",\"Toxiproxy\",\"Network\"],\"photo-credits\":null,\"applaud-link\":\"2021/spring-boot-stream-kafka.json\",date:\"2022-11-17\",draft:!1,summary:\"Here we look into using Toxiproxy to add network problems between systems communicating over the network\",imageUrl:\"/static/images/2022/introducing-network-problems-with-toxiproxy/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(t,{})})):t();function t(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",div:\"div\"},a.components),{AdsFlows:c,Image:i}=e;return c||d(\"AdsFlows\",!0),i||d(\"Image\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"introduction\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#introduction\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),`\n`,(0,n.jsx)(e.p,{children:\"In modern software architecture, systems communicate with each other over the network. No matter if it is synchronous or asynchronous communication, handling and dealing with communication errors can be very difficult. The main reason is that it is not easy to reproduce these communication problems.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Today we will look at a tool called \",(0,n.jsx)(e.a,{href:\"https://github.com/Shopify/toxiproxy\",children:\"Toxiproxy\"}),\" with which you can simulate a wide variety of network-related problems.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"creating-an-application\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-an-application\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Creating An Application\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s create a simple application that provides a single endpoint that communicates with the database to fetch some data.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"For this, we will create a Spring Boot application from \",(0,n.jsx)(e.a,{href:\"https://start.spring.io\",children:\"https://start.spring.io\"}),\" and add the following dependencies\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Spring Data JPA\"}),`\n`,(0,n.jsx)(e.li,{children:\"Spring Web\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Once we generate the project, we will add a controller that fetches all the posts from the database.\"}),`\n`,(0,n.jsx)(c,{id:\"adflow1\",slot:\"8168941152\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@RestController\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"WebController\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"final\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PostRepository\"}),\" postRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"WebController\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PostRepository\"}),\" postRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"postRepository \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" postRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@GetMapping\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/blog\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"List\"}),(0,n.jsxs)(e.span,{className:\"token generics\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"BlogPost\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" postRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findAll\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Now, let's add some properties to communicate with the database.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"spring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"datasource\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" jdbc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"mysql\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//127.0.0.1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`13306/database\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"username\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` user1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"password\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` password\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here we specify port 13306, which is going to be our proxy port.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now, let\\u2019s start our database using docker-compose\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"version\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'3.8'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"services\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"mysql\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" mysql/mysql\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5.7\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"ports\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" 3306\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3306\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"environment\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"MYSQL_ROOT_PASSWORD\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` password\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"MYSQL_DATABASE\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` database\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"MYSQL_USER\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` user1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"MYSQL_PASSWORD\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` password\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here, if you see, we are exposing port 3306 for the MySQL container.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now, let's create a proxy with Toxiproxy\"}),`\n`,(0,n.jsx)(c,{id:\"adflow2\",slot:\"2393870295\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"starting-toxiproxy\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#starting-toxiproxy\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Starting Toxiproxy\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Before we create a proxy, we need to start the Toxiproxy server.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"We can start a Toxiproxy server using docker but if you want you can also install the Toxiproxy CLI from \",(0,n.jsx)(e.a,{href:\"https://github.com/Shopify/toxiproxy/releases\",children:\"here\"}),\" to start the server.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"docker run --rm \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"--net \",(0,n.jsx)(e.span,{className:\"token function\",children:\"host\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"-p \",(0,n.jsx)(e.span,{className:\"token number\",children:\"8474\"}),\":8474 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ghcr.io/shopify/toxiproxy\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"With the server running it's time to create our proxy to the database.\"}),`\n`,(0,n.jsx)(e.p,{children:\"For this, we will run the following command.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsx)(e.code,{className:\"language-shell code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`toxiproxy-cli create -l localhost:13306 -u localhost:3306 db-proxy\n`})})}),`\n`,(0,n.jsx)(e.p,{children:\"You can also run all commands without installing the CLI and execute it with docker as shown below\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"docker run --rm \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"--net \",(0,n.jsx)(e.span,{className:\"token function\",children:\"host\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"--entrypoint\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/toxiproxy-cli\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"-it \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"ghcr.io/shopify/toxiproxy \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`create -l localhost:13306 -u localhost:3306 db-proxy\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"This will create a proxy for us at port 13306 communicating with the upstream database service at 3306.\"}),`\n`,(0,n.jsx)(e.p,{children:\"With this, we can now start our application and communicate with the database via the proxy.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s look at how much time it takes to get a response for the endpoint to communicate with the database via the proxy.\"}),`\n`,(0,n.jsx)(c,{id:\"adflow3\",slot:\"1404222257\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(i,{alt:\"time without proxy\",src:\"/static/images/2022/introducing-network-problems-with-toxiproxy/time-without-proxy.png\",width:\"892\",height:\"150\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"introducing-network-problems\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#introducing-network-problems\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Introducing network problems\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s look at how we can introduce some network problems.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Toxiproxy has this concept of toxics, that you can add to the proxy to introduce some network-related issues.\"}),`\n`,(0,n.jsx)(e.p,{children:\"We will start with the simplest one i.e latency in the connection while fetching data.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsx)(e.code,{className:\"language-shell code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"toxiproxy-cli toxic \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),\" -t latency -a \",(0,n.jsx)(e.span,{className:\"token assign-left variable\",children:\"latency\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1000\"}),` db-proxy\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"When we execute this, we are adding a latency of 1000ms to the downstream connection (default stream option) with toxicity of 1.0 (default). Toxicity refers to the probability of applying the toxic\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(i,{alt:\"creatng a proxy\",src:\"/static/images/2022/introducing-network-problems-with-toxiproxy/proxy-create.png\",width:\"1050\",height:\"270\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Let\\u2019s now try to access the same endpoint from before and see how long it takes to get a response.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(i,{alt:\"time with proxy\",src:\"/static/images/2022/introducing-network-problems-with-toxiproxy/time-with-proxy.png\",width:\"892\",height:\"150\"})}),`\n`,(0,n.jsx)(e.p,{children:\"So as you can see, it took quite some time to get a response.\"}),`\n`,(0,n.jsx)(e.p,{children:\"This is just one type of latency we introduced. We can also add a jitter to introduce irregular packet flow.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Toxiproxy supports quite number of toxics, like timeout, peer connection reset, data limits, etc and you can find all of them \",(0,n.jsx)(e.a,{href:\"https://github.com/Shopify/toxiproxy#toxics\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Finally, we can remove the toxic with the following command.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsx)(e.code,{className:\"language-shell code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`toxiproxy-cli toxic remove -n latency_downstream db-proxy\n`})})}),`\n`,(0,n.jsx)(c,{id:\"adflow4\",slot:\"2523816518\"}),`\n`,(0,n.jsx)(e.p,{children:\"Another feature that Toxiproxy provides is that you can communicate with the running server with a set of REST calls as shown below.\"}),`\n`,(0,n.jsx)(e.div,{children:(0,n.jsx)(i,{alt:\"toxiproxy rest endpoints\",src:\"/static/images/2022/introducing-network-problems-with-toxiproxy/rest-endpoint.png\",width:\"892\",height:\"673\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"testing-with-testcontainers\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#testing-with-testcontainers\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Testing With Testcontainers\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Toxiproxy also provides Testcontainer support and we will use it to write a simple integration test.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Container\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"GenericContainer\"}),\" mySQLContainer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MySQLContainer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DockerImageName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"parse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"mysql/mysql-server:5.7\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"asCompatibleSubstituteFor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"mysql\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withDatabaseName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"database\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withUsername\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"user1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withPassword\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"password\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withNetwork\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"network\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Container\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ToxiproxyContainer\"}),\" toxiProxy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ToxiproxyContainer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"withNetwork\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"network\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@DynamicPropertySource\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"properties\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DynamicPropertyRegistry\"}),\" registry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        registry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"spring.datasource.url\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"createDBProxy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"createDBProxy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        dbProxy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" toxiProxy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getProxy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mySQLContainer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3306\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"jdbc:mysql://\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" dbProxy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getContainerIpAddress\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\":\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" dbProxy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"getProxyPort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/database\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Here we set up the Toxiproxy container to create a proxy between the application and the MySQL container.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Next, let's write a test that will introduce a timeout and then catch the exception that is thrown.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-java\",children:(0,n.jsxs)(e.code,{className:\"language-java code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Test\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token annotation punctuation\",children:\"@Transactional\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"propagation \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Propagation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NOT_SUPPORTED\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"void\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"checkTimeoutConditionWithDatabase\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"throws\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"IOException\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"assertThat\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"postRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findAll\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"isEmpty\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        dbProxy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"toxics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"timeout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"timeout\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ToxicDirection\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"DOWNSTREAM\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1000\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"assertThatThrownBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"->\"}),\" postRepository\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"findAll\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"isInstanceOf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Exception\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(c,{id:\"adflow5\",slot:\"9474283966\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"conclusion\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#conclusion\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Today we saw how we can introduce some network issues between systems that communicate over the network. We can use this mechanism to look into how your system would handle such network-related problems.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can find the code on my GitHub repo \",(0,n.jsx)(e.a,{href:\"https://github.com/amrutprabhu/kubernetes-deployment-with-skaffold\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I keep exploring and learning new things. If you want to know the latest trends and improve your software development skills, then subscribe to my newsletter below and also follow me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/amrutprabhu42\",children:\"Twitter\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Enjoy!!\"})]})}}var v=b;function d(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return T;})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":2},{"value":"Creating An Application","url":"#creating-an-application","depth":2},{"value":"Starting Toxiproxy","url":"#starting-toxiproxy","depth":2},{"value":"Introducing network problems","url":"#introducing-network-problems","depth":2},{"value":"Testing With Testcontainers","url":"#testing-with-testcontainers","depth":2},{"value":"Conclusion","url":"#conclusion","depth":2}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.315,"time":378900,"words":1263},"slug":"2022/create-network-problems-with-toxiproxy","fileName":"2022/create-network-problems-with-toxiproxy.md","title":"Create Network Problems With Toxiproxy","author":"Amrut Prabhu","categories":"","tags":["Java","Spring Boot","Toxiproxy","Network"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-11-17T00:00:00.000Z","draft":false,"summary":"Here we look into using Toxiproxy to add network problems between systems communicating over the network","imageUrl":"/static/images/2022/introducing-network-problems-with-toxiproxy/cover.jpg","actualUrl":"2022/create-network-problems-with-toxiproxy","customUrl":"create-network-problems-with-toxiproxy"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Deploy Application on Kubernetes with Helm, JIB, and Skaffold","author":"Amrut Prabhu","categories":"","tags":["Java","Spring Boot","Kubernetes","Docker","Skaffold"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-11-10T00:00:00.000Z","draft":false,"summary":"Here we explore creating and running a Skaffold pipeline for deployment on a Kubernetes Cluster","imageUrl":"/static/images/2022/spring-boot-deployment-with-skaffold/cover.jpg","actualUrl":"2022/deploy-application-on-kubernetes-with-skaffold-helm-jib","customUrl":"deploy-application-on-kubernetes-with-skaffold-helm-jib","slug":"deploy-application-on-kubernetes-with-skaffold-helm-jib"},"next":{"title":"What Are Virtual Threads In Java","author":"Amrut Prabhu","categories":"","tags":["Java","JDK19","Virtual Threads","Multithreading"],"photo-credits":"https://unsplash.com/photos/NLgqFA9Lg_E","applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-12-15T00:00:00.000Z","draft":false,"summary":"We will look into the concepts of Virtual threads that are provided as a preview feature in JDK 19","imageUrl":"/static/images/2022/what-are-virtual-threads/cover.jpg","actualUrl":"2022/what-are-virtual-threads-in-java","customUrl":"what-are-virtual-threads-in-java","slug":"what-are-virtual-threads-in-java"}},"__N_SSG":true}