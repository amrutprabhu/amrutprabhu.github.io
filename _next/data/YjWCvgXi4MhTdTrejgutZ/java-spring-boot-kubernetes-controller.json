{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var t=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=>t(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var c in s)t(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!m.call(a,n)&&n!==\"default\"&&t(a,n,{get:()=>s[n],enumerable:!(c=p(s,n))||c.enumerable});return a},w=a=>g(i(t(a!=null?d(u(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((x,o)=>{o.exports=_jsx_runtime});var I={};k(I,{default:()=>y,frontmatter:()=>f});var e=w(r()),f={title:\"Part 2: How to Create a Spring Boot Kubernetes Controller\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Kubernetes\",\"yaml\",\"Docker\"],\"photo-credits\":null,\"applaud-link\":\"2021/spring-boot-stream-kafka.json\",date:\"2022-07-21\",draft:!1,summary:\" In this article, we learn how to create a Spring Boot based Kubernetes Controller and explore the various components needed to create it.\",imageUrl:\"/static/images/2022/create-kubernetes-controller-with-spring/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",a:\"a\",h1:\"h1\",span:\"span\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",blockquote:\"blockquote\",strong:\"strong\",h2:\"h2\",div:\"div\"},a.components),{Image:l}=n;return l||C(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"In my earlier article \",(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/create-kubernetes-custom-resource-definition-crd\",children:\"here\"}),\", we saw how we can create a Kubernetes Custom Resource Definition (CRD) and deploy it to a Kubernetes cluster. In this article, we will look at creating a Kubernetes Controller using Spring Boot that will handle requests when a CRD instance is created, updated, or deleted.\"]}),`\n`,(0,e.jsxs)(n.h1,{id:\"project-setup\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#project-setup\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Project Setup\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Let\\u2019s go to \",(0,e.jsx)(n.a,{href:\"https://start.spring.io\",children:\"https://start.spring.io\"}),\" and create a new project with the following dependencies.\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Spring Starter Web\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Next, you need to add the Kubernetes Java client dependency as below\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-xml\",children:(0,e.jsxs)(n.code,{className:\"language-xml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"dependency\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"groupId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\"io.kubernetes\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"groupId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"artifactId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\"client-java-spring-integration\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"artifactId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"version\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\"16.0.0\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"version\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"dependency\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"With this, we are ready with the setup.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"generating-java-model-classes-for-crd\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#generating-java-model-classes-for-crd\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Generating Java Model Classes For CRD\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In order to work with the Kubernetes CRD, we created in the previous article, we would need to get Java class representations of the CRD.\"}),`\n`,(0,e.jsx)(n.p,{children:\"We can use a utility that will generate the class files from a deployed CRD.\"}),`\n`,(0,e.jsx)(n.p,{children:\"For this, you need to have docker running and then run the following command.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token shebang important\",children:\"#!/usr/bin/env bash\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"LOCAL_MANIFEST_FILE\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`/home/amrut/projects/kubernetes-custom-resource/crd/my-crd.yaml\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"mkdir\"}),\" -p /tmp/java \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"cd\"}),` /tmp/java\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"docker run \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --rm \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -v \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$LOCAL_MANIFEST_FILE\"}),'\"']}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$LOCAL_MANIFEST_FILE\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -v /var/run/docker.sock:/var/run/docker.sock \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -v \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"pwd\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"pwd\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -ti \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --network \",(0,e.jsx)(n.span,{className:\"token function\",children:\"host\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  ghcr.io/kubernetes-client/java/crd-model-gen:v1.0.6 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  /generate.sh \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -u \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$LOCAL_MANIFEST_FILE\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -n prabhu.amrut.com \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -p com.amrut.prabhu \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -o \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"pwd\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Let me explain what this command does.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"It first creates a temp directory to store the generated classes. It then starts a \",(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/kind-kubernetes-cluster\",children:\"Kind Kubernetes Cluster\"}),\" using Docker, applies the mounted Kubernetes CRD file to the cluster, and generates the Java class files from the deployed CRD in the temp directory.\"]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Important note\"}),\": The flag -n should be the reverse order of the group name. In our case its \",(0,e.jsx)(n.code,{children:\"prabhu.amrut.com\"}),\" since the group name was \",(0,e.jsx)(n.code,{children:\"com.amrut.prabhu\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"You can always read about this in their documentation \",(0,e.jsx)(n.a,{href:\"https://github.com/kubernetes-client/java/blob/master/docs/generate-model-from-third-party-resources.md#example-commands-for-local-crd-manifests\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsxs)(n.h1,{id:\"understanding-the-use-case\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#understanding-the-use-case\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding the Use Case\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Before we start creating the controller, let\\u2019s understand the use case we want to achieve.\"}),`\n`,(0,e.jsx)(n.p,{children:\"When we create a CRD instance, we want the controller to create a Kubernetes config map. If the CRD instance is updated, the controller updates the config map and similarly, if it is deleted, the config map is deleted.\"}),`\n`,(0,e.jsx)(n.p,{children:\"With this understanding, Let\\u2019s create our Kubernetes Controller.\"}),`\n`,(0,e.jsxs)(n.h1,{id:\"creating-a-kubernetes-controller\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-a-kubernetes-controller\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating a Kubernetes Controller\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now to create a controller, we need to create a few components.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"A reconciler: This component is used to handle requests when there is a change in the CRD instance. It will be invoked when we create, update or delete a CRD instance so that we can do something with the changes.\"}),`\n`,(0,e.jsx)(n.li,{children:\"A Shared Index Informer: This is more like a cache, so the controller does not need to continuously poll the Kubernetes cluster (API server) to check if there are any new CRD instances created, updated, or deleted.\"}),`\n`,(0,e.jsx)(n.li,{children:\"APIClient: It is a client used to connect to the Kubernetes Cluster (API server)\"}),`\n`,(0,e.jsx)(n.li,{children:\"CRD Model: These are the model classes we generated earlier.\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s start with creating the first component which is the shared index informer.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-java\",children:(0,e.jsxs)(n.code,{className:\"language-java code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@Bean\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SharedIndexInformer\"}),(0,e.jsxs)(n.span,{className:\"token generics\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1MyCrd\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sharedIndexInformer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SharedInformerFactory\"}),\" sharedInformerFactory\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ApiClient\"}),\" apiClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"GenericKubernetesApi\"}),(0,e.jsxs)(n.span,{className:\"token generics\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1MyCrd\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1MyCrdList\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\" api \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"GenericKubernetesApi\"}),(0,e.jsxs)(n.span,{className:\"token generics\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1MyCrd\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1MyCrdList\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"com.amrut.prabhu\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"my-crds\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            apiClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" sharedInformerFactory\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"sharedIndexInformerFor\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"api\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1MyCrd\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"So here, we create an index informer, which will be having a reference of an APIClient to look for any created instances of the CRD.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"understanding-the-reconciler-component\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#understanding-the-reconciler-component\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding the Reconciler Component\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now, to understand what we should do in the reconciler, let\\u2019s see this with a small flow chart.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(l,{alt:\"Reconciler Flowchart\",src:\"/static/images/2022/create-kubernetes-controller-with-spring/reconciler-flowchart.png\",width:\"683\",height:\"1398\"})}),`\n`,(0,e.jsx)(n.p,{children:\"This is the simplest algorithm.\"}),`\n`,(0,e.jsx)(n.p,{children:\"As you can see in the flow chart, there are 3 variants of the incoming requests i.e Create, Update, and Delete.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s look at them.\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Create Instance Request:- When we receive this request, we get a reference to the resource instance from the index informer. We can then do something like creating a config map. Now, when we create a new resource as a result of CRD instance creation, we need to set the current CRD instance as the owner of the new resource. Why? we will find out soon.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Update Instance Request: In this case, we get an updated reference of the CRD instance and we perform an update on our components i.e. update the previously created config map.\"}),`\n`,(0,e.jsx)(n.li,{children:\"Delete Instance Request: In this case, we don't have to do anything. As soon as we delete the CRD instance, Kubernetes automatically deletes all the resources it owns. This is why we set the ownership while creating a new resource.\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"implementing-the-reconciler-component\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#implementing-the-reconciler-component\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Implementing the Reconciler Component\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s look at the reconciler code in two parts.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-java\",children:(0,e.jsxs)(n.code,{className:\"language-java code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"request \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"->\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),\" key \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getNamespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1MyCrd\"}),\" resourceInstance \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` shareIndexInformer\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getIndexer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getByKey\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"resourceInstance \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1ConfigMap\"}),\" v1ConfigMap \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"createConfigMap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"resourceInstance\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            coreV1Api\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"createNamespacedConfigMap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getNamespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    v1ConfigMap\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"true\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ApiException\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Here, when the request that comes in just contains the namespace and the name of the resource that was created. We then fetch the reference to the CRDS instance using the shared index former. If the instance was created, we would get a reference, or else it will be null indicating the instance was deleted. Once we get the reference, we then create a Kubernetes config map using the CoreAPI.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s look at the config map creation function.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-java\",children:(0,e.jsxs)(n.code,{className:\"language-java code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1ConfigMap\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"createConfigMap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1MyCrd\"}),\" resourceInstance\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1ConfigMap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1ObjectMeta\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"my-config-map\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"addOwnerReferencesItem\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"V1OwnerReference\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"resourceInstance\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getApiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"resourceInstance\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getKind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"resourceInstance\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getMetadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"uid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"resourceInstance\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getMetadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getUid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Map\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"_of_\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"amrut\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"prabhu\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"If you see here, I create a new config map object and set the reference of the current CRD instance as the owner of the config map.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now let\\u2019s look at what happens during the update.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-java\",children:(0,e.jsxs)(n.code,{className:\"language-java code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ApiException\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"System\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"_out_\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getCode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"409\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            coreV1Api\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"replaceNamespacedConfigMap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"my-config-map\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getNamespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    v1ConfigMap\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"true\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ApiException\"}),\" ex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"throw\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RuntimeException\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"throw\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RuntimeException\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"When we receive an update, the index informer just gives us a reference to the updated CRD instance, and we still don't know if the incoming request is for a create or update.\"}),`\n`,(0,e.jsx)(n.p,{children:\"So we proceed with a normal create approach, which fails by throwing an exception with a code 409, which means the resource is already created. We then know that the current request is an update and update the config map.\"}),`\n`,(0,e.jsx)(n.p,{children:\"In the case of the delete, we don't have to do anything. Kubernetes will automatically delete all the resources owned by our CRD instance.\"}),`\n`,(0,e.jsx)(n.p,{children:\"This is the reason we need to set the CRD instance as the owner of all the resources we created while handling the CRD instance creation request.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(l,{alt:\"CRD apply output\",src:\"/static/images/2022/create-kubernetes-controller-with-spring/crds-instance-apply-output.png\",width:\"1908\",height:\"708\"})}),`\n`,(0,e.jsxs)(n.h1,{id:\"conclusion\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#conclusion\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Today we created a Spring Boot Kubernetes controller and handled requests for our own Kubernetes CRD instance creation, update, or deletion.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"This article is largely inspired by a presentation from \",(0,e.jsx)(n.a,{href:\"https://twitter.com/ciberkleid\",children:\"Cora Iberkleid\"}),\" and \",(0,e.jsx)(n.a,{href:\"https://twitter.com/starbuxman\",children:\"Josh Long\"}),\" at the \",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=5IROOj7sLKg\",children:\"Spring IO conference\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"You can find the entire code on my GitHub repo \",(0,e.jsx)(n.a,{href:\"https://github.com/amrutprabhu/kubernetes-custom-resource\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I keep exploring and learning new things. If you want to know the latest trends and improve your software development skills, then subscribe to my newsletter below and also follow me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/amrutprabhu42\",children:\"Twitter\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Enjoy!!\"})]})}}var y=b;function C(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return I;})();\n;return Component;","toc":[{"value":"Project Setup","url":"#project-setup","depth":1},{"value":"Generating Java Model Classes For CRD","url":"#generating-java-model-classes-for-crd","depth":1},{"value":"Understanding the Use Case","url":"#understanding-the-use-case","depth":1},{"value":"Creating a Kubernetes Controller","url":"#creating-a-kubernetes-controller","depth":1},{"value":"Understanding the Reconciler Component","url":"#understanding-the-reconciler-component","depth":2},{"value":"Implementing the Reconciler Component","url":"#implementing-the-reconciler-component","depth":2},{"value":"Conclusion","url":"#conclusion","depth":1}],"frontMatter":{"readingTime":{"text":"9 min read","minutes":8.42,"time":505200,"words":1684},"slug":"2022/java-spring-boot-kubernetes-controller","fileName":"2022/java-spring-boot-kubernetes-controller.md","title":"Part 2: How to Create a Spring Boot Kubernetes Controller","author":"Amrut Prabhu","categories":"","tags":["Kubernetes","yaml","Docker"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-07-21T00:00:00.000Z","draft":false,"summary":" In this article, we learn how to create a Spring Boot based Kubernetes Controller and explore the various components needed to create it.","imageUrl":"/static/images/2022/create-kubernetes-controller-with-spring/cover.jpg","actualUrl":"2022/java-spring-boot-kubernetes-controller","customUrl":"java-spring-boot-kubernetes-controller"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)","author":"Amrut Prabhu","categories":"","tags":["Kubernetes","yaml","Docker"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-07-07T00:00:00.000Z","draft":false,"summary":" In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)","imageUrl":"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg","actualUrl":"2022/create-kubernetes-custom-resource-definition-crd","customUrl":"create-kubernetes-custom-resource-definition-crd","slug":"create-kubernetes-custom-resource-definition-crd"},"next":{"title":"How To Fix Keycloak Oauth2 OIDC Logout With Spring Cloud Gateway","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Java","Gateway","Keycloak","Oauth2","OpenId Connect","Resource Server","Docker"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-08-11T00:00:00.000Z","draft":false,"summary":" In this article, we look at how we can fix the keycloak Oauth2 OIDC logout issue with Spring Cloud Gateway","imageUrl":"/static/images/2022/fix-keycloak-oidc-logout-issue/cover.jpg","actualUrl":"2022/fix-keycloak-oauth2-oidc-logout-with-spring-cloud-gateway","customUrl":"fix-keycloak-oauth2-oidc-logout-with-spring-cloud-gateway","slug":"fix-keycloak-oauth2-oidc-logout-with-spring-cloud-gateway"}},"__N_SSG":true}