<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/icon.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/icon.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('light');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="amrutprabhu" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18" strategy="afterInteractive" async=""></script><title>Part 1: How to Create a Kubernetes Custom Resource Definition (CRD) | RefactorFirst</title><meta name="robots" content="follow, index"/><meta name="description" content=" In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)"/><meta property="og:url" content="https://refactorfirst.com/create-kubernetes-custom-resource-definition-crd"/><meta property="og:type" content="article"/><meta property="og:site_name" content="RefactorFirst"/><meta property="og:description" content=" In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)"/><meta property="og:title" content="Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)"/><meta property="og:image" content="https://refactorfirst.com/static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/amrutprabhu42"/><meta name="twitter:title" content="Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)"/><meta name="twitter:description" content=" In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)"/><meta name="twitter:image" content="https://refactorfirst.com/static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg"/><meta property="article:published_time" content="2022-07-07T00:00:00.000Z"/><link rel="canonical" href="https://refactorfirst.com/create-kubernetes-custom-resource-definition-crd"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://refactorfirst.com/2022/create-kubernetes-custom-resource-definition-crd"
  },
  "headline": "Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://refactorfirst.com/static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg"
    }
  ],
  "datePublished": "2022-07-07T00:00:00.000Z",
  "dateModified": "2022-07-07T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Amrut Prabhu"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Amrut Prabhu",
    "logo": {
      "@type": "ImageObject",
      "url": "https://refactorfirst.com/static/images/favicons/icon.png"
    }
  },
  "description": " In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)"
}</script><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/css/5227e983b097ec3e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5227e983b097ec3e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-1aed8795b16b27b2.js" defer=""></script><script src="/_next/static/chunks/main-a8532ea7c2505ecc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-64dd201752dfa526.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/207-4f91422181f853c0.js" defer=""></script><script src="/_next/static/chunks/984-e059826b5bf22bce.js" defer=""></script><script src="/_next/static/chunks/883-9cd53d582322e5e7.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-28f0421685e6788f.js" defer=""></script><script src="/_next/static/ivNckGx43FZiLYbTxZihH/_buildManifest.js" defer=""></script><script src="/_next/static/ivNckGx43FZiLYbTxZihH/_ssgManifest.js" defer=""></script><script src="/_next/static/ivNckGx43FZiLYbTxZihH/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="RefactorFirst" href="/"><div class="flex items-center justify-between"><div class="mr-3"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img srcSet="static/favicons/icon.png?imwidth=64 1x, static/favicons/icon.png?imwidth=128 2x" src="static/favicons/icon.png?imwidth=128" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><div class="h-6 text-2xl font-semibold sm:block">RefactorFirst</div></div></a></div><div class="mt-6"></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/posts">Posts</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/posts">Posts</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed flex-col hidden gap-3 right-8 bottom-8 md:flex"><button aria-label="Scroll To Top" type="button" style="opacity:0" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-07-07T00:00:00.000Z">Thursday, July 7, 2022</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)</h1><div class="mt-6"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzQ0IiBoZWlnaHQ9IjQwNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="object-cover object-center lg:h-48 md:h-36" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)" srcSet="static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg?imwidth=750 1x, static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg?imwidth=1920 2x" src="static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg?imwidth=1920" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="object-cover object-center lg:h-48 md:h-36" loading="lazy"/></noscript></span></div><div class="text-primary-500 hover:text-primary-600 text-md dark:hover:text-primary-400"><div></div></div><div class="mt-2 text-gray-500 dark:text-gray-400">7 min read</div></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzgiIGhlaWdodD0iMzgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="w-10 h-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="static/images/avatar-small.jpg?imwidth=48 1x, static/images/avatar-small.jpg?imwidth=96 2x" src="static/images/avatar-small.jpg?imwidth=96" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="w-10 h-10 rounded-full" loading="lazy"/></noscript></span><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Amrut Prabhu</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/amrutprabhu42" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@amrutprabhu42</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose text-md dark:prose-dark max-w-none"><p>This is a multi-part article on how you can create a Kubernetes Custom Resource Definition (CRD) and then create a Kubernetes controller to handle CRD instance creation requests. In this article, we would be exploring how we can create your own Kubernetes CRD.</p>
<h2 id="understanding-how-kubernetes-works-with-resources"><a href="#understanding-how-kubernetes-works-with-resources" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Understanding How Kubernetes Works with Resources</h2>
<p>Before we move on to creating our first CRD and controller, we have to understand some concepts behind how Kubernetes resource management works.</p>
<p>Let’s look at the diagram</p>
<div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTE4NyIgaGVpZ2h0PSI2MDkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img alt="Kubernetes working" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Kubernetes working" srcSet="static/images/2022/create-kubernetes-custom-resource-defintion-crd/kubernetes-working.png?imwidth=1200 1x, static/images/2022/create-kubernetes-custom-resource-defintion-crd/kubernetes-working.png?imwidth=3840 2x" src="static/images/2022/create-kubernetes-custom-resource-defintion-crd/kubernetes-working.png?imwidth=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div>
<p>As you see in the diagram, we have an API server, scheduler, controller, and database. When we use the command <code>kubectl</code> to create a resource, we are actually talking to the API server and the API server merely stores the resource in the database. Now, we have a scheduler, which keeps on asking the API server if there are some resources created.</p>
<p>Once the scheduler finds that a pod has to be created, it then inserts into the database via the API server the reference of the node where the pod will be created.</p>
<p>Next, Kubelets running on the various worker nodes start calling the API server and check if any pods have to be created on that particular node. Kubelets are nothing but controllers themselves.</p>
<p>So in this article, we will see how you can create your own Kubernetes CRD, and then create an instance of the CRD.</p>
<h2 id="pre-requisites"><a href="#pre-requisites" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Pre-requisites</h2>
<ul>
<li>A working Kubernetes cluster. (local or remote)<br/>
<!-- -->If you don&#x27;t have one, you can always run a <a target="_blank" rel="noopener noreferrer" href="https://k3s.io/">K3s</a> cluster locally or you can use a Kind Kubernetes cluster. You can read about starting a Kind Kubernetes cluster <a target="_blank" rel="noopener noreferrer" href="https://refactorfirst.com/kind-kubernetes-cluster">here</a>.</li>
<li>Basic knowledge of working with “Kubectl” commands to create, get or delete a resource.</li>
</ul>
<h2 id="creating-a-kubernetes-custom-resource-definition-crd"><a href="#creating-a-kubernetes-custom-resource-definition-crd" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Creating a Kubernetes Custom Resource Definition (CRD)</h2>
<p>Let&#x27;s create a simple Kubernetes Custom Resource Definition and view its various parts.</p>
<div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apiextensions.k8s.io/v1
</span><span class="code-line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> CustomResourceDefinition
</span><span class="code-line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>crds.com.amrut.prabhu
</span><span class="code-line"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">group</span><span class="token punctuation">:</span> com.amrut.prabhu
</span><span class="code-line">  <span class="token key atrule">names</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">kind</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>crd
</span><span class="code-line">    <span class="token key atrule">plural</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>crds
</span><span class="code-line">  <span class="token key atrule">scope</span><span class="token punctuation">:</span> Namespaced
</span><span class="code-line">  <span class="token key atrule">versions</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> v1
</span><span class="code-line">      <span class="token key atrule">served</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token key atrule">schema</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token key atrule">openAPIV3Schema</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">          <span class="token key atrule">properties</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token key atrule">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">            <span class="token key atrule">kind</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token key atrule">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">            <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token key atrule">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">            <span class="token key atrule">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token key atrule">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">              <span class="token key atrule">properties</span><span class="token punctuation">:</span>
</span><span class="code-line">                <span class="token key atrule">my-own-property</span><span class="token punctuation">:</span>
</span><span class="code-line">                  <span class="token key atrule">type</span><span class="token punctuation">:</span> string
</span></code></pre></div>
<p>This is the most minimalistic definition to create your own Kubernetes CRD.</p>
<p>To understand this, Let’s break it up into two parts.</p>
<p><strong>Part 1</strong>: Define the metadata and definition of the CRD</p>
<p><strong>Part 2</strong>: Define the schema of the CRD instances that we will create later.</p>
<h2 id="understanding-the-kubernetes-custom-resource-definition-format"><a href="#understanding-the-kubernetes-custom-resource-definition-format" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Understanding The Kubernetes Custom Resource Definition Format</h2>
<p>Let&#x27;s Look at Part 1.</p>
<div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apiextensions.k8s.io/v1
</span><span class="code-line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> CustomResourceDefinition
</span><span class="code-line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>crds.com.amrut.prabhu
</span><span class="code-line"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">group</span><span class="token punctuation">:</span> com.amrut.prabhu
</span><span class="code-line">  <span class="token key atrule">names</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">kind</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>crd
</span><span class="code-line">    <span class="token key atrule">plural</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>crds
</span><span class="code-line">  <span class="token key atrule">scope</span><span class="token punctuation">:</span> Namespaced
</span><span class="code-line">  <span class="token key atrule">versions</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> v1
</span><span class="code-line">      <span class="token key atrule">served</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span></code></pre></div>
<p>Here we define the “Kind” of our resource, i.e we want to create a CRD and we provide it a name. The name has to be of the format <code>&lt;CRD plural Name&gt;.&lt;Group name&gt;</code> , ie. “<code>my-crds</code> <code>.</code> <code>com.amrut.prabhu</code> ”. Next, in the <code>spec</code> section, we define the name and the plural name of the kind we are creating. This is the type we will specify while creating a new instance later.</p>
<p>Next, we define that the CRD will be scoped to a namespace and in the version section, we specify the version of this CRD to <code>v1</code>. When we want to create a new version of this definition, we will just bump up this version number.</p>
<p>Lastly, we have <code>served</code> property that defines if this CRD is enabled to be used in the cluster and <code>storage</code> refers to if this version of the CRD will be stored. At a time you can have only one version of the CRD that can be stored.</p>
<p>This was all about defining our CRD. Let’s look at the schema of the CRD.</p>
<h3 id="understanding-crd-schema"><a href="#understanding-crd-schema" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Understanding CRD Schema</h3>
<div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">schema</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">openAPIV3Schema</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token key atrule">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">      <span class="token key atrule">kind</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token key atrule">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">      <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token key atrule">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">      <span class="token key atrule">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token key atrule">properties</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">my-own-property</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token key atrule">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">        <span class="token key atrule">type</span><span class="token punctuation">:</span> object
</span></code></pre></div>
<p>In this, we define the schema using the Open API version 3 standards. We specify the top level as an object which has some properties.</p>
<p>Now, some of the absolutely required properties are:</p>
<ul>
<li><code>apiVersion</code>: To define the version of the CRD we will be using.</li>
<li><code>kind</code>: The type of the CRD</li>
<li><code>metadata</code>: The metadata which will be added such as the name, annotations, etc. This will be of the type Object.</li>
<li><code>spec</code>: This defines the custom specifications properties you want to provide.</li>
</ul>
<p>Now, in the above schema, I have specified only one property i.e <code>my-own-property</code> in the spec section. You can also define a property of type object having its own properties.</p>
<p>Let&#x27;s look at how the CRD is mapped to our CRD instance.</p>
<div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTc0OCIgaGVpZ2h0PSIxMjQwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="/></span><img alt="CRD to CRD instance Mapping" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="CRD to CRD instance Mapping" srcSet="static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-to-instance-map.jpg?imwidth=1920 1x, static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-to-instance-map.jpg?imwidth=3840 2x" src="static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-to-instance-map.jpg?imwidth=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div>
<p>As you can see above, the arrows make it simple to understand which property from the CRD maps to the CRD instance. This is how our custom resource definition is mapped to the actual instance YAML file.</p>
<p>With this, let&#x27;s first apply our CRD to the Kubernetes cluster.</p>
<h2 id="adding-kubernetes-crd-to-the-kubernetes-cluster"><a href="#adding-kubernetes-crd-to-the-kubernetes-cluster" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Adding Kubernetes CRD to the Kubernetes Cluster</h2>
<p>In order to use our CRD, We will have to add it to our Kubernetes Cluster. Let’s install this using the following command</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">kubectl apply -f my-crd.yaml
</span></code></pre></div>
<div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYwMiIgaGVpZ2h0PSI1NDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img alt="CRD apply" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="CRD apply" srcSet="static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-apply.png?imwidth=1920 1x, static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-apply.png?imwidth=3840 2x" src="static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-apply.png?imwidth=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div>
<p>Now, after creating the CRD, we are going to create our first CRD instance. We will use the same instance YAML file from above.</p>
<div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> com.amrut.prabhu/v1
</span><span class="code-line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>crd
</span><span class="code-line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>custom<span class="token punctuation">-</span>resource<span class="token punctuation">-</span>instance
</span><span class="code-line"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">my-own-property</span><span class="token punctuation">:</span> <span class="token string">&#x27;My first CRD instance&#x27;</span>
</span></code></pre></div>
<div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYwMiIgaGVpZ2h0PSIzODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img alt="CRD Instance Apply" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="CRD Instance Apply" srcSet="static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-instance-apply.png?imwidth=1920 1x, static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-instance-apply.png?imwidth=3840 2x" src="static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-instance-apply.png?imwidth=3840" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div>
<p>With this, we just created our first Kubernetes CRD and then created our first CRD instance.</p>
<p>After creating the instance nothing really happened. Only the instance object was created and stored in the Kubernetes database.</p>
<p>But we want it to do something when we create an instance.</p>
<p>For this, we will need to implement a controller that will handle creating instance requests and do something with it. We will explore this in our next article.</p>
<p>You can find CRD yaml files on GitHub <a target="_blank" rel="noopener noreferrer" href="https://github.com/amrutprabhu/kubernetes-custom-resource/tree/main/crd">here</a>.</p>
<p>So, subscribe to my newsletter below and follow me on <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/amrutprabhu42">Twitter</a> to know when the article is published.</p>
<p>Enjoy!!</p></div><hr/></div><footer><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="m-1 p-1 leading-4 h-6 rounded text-xs uppercase text-white bg-teal-500 hover:bg-teal-600 dark:hover:bg-teal-500 dark:bg-teal-600" href="/tags/kubernetes">Kubernetes</a><a class="m-1 p-1 leading-4 h-6 rounded text-xs uppercase text-white bg-teal-500 hover:bg-teal-600 dark:hover:bg-teal-500 dark:bg-teal-600" href="/tags/yaml">yaml</a><a class="m-1 p-1 leading-4 h-6 rounded text-xs uppercase text-white bg-teal-500 hover:bg-teal-600 dark:hover:bg-teal-500 dark:bg-teal-600" href="/tags/docker">Docker</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/3-ways-to-create-spring-boot-docker-images">3 Ways to Create Spring Boot Docker Images Without Docker File</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/java-spring-boot-kubernetes-controller">Part 2: How to Create a Spring Boot Kubernetes Controller</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/">← Back to the articles</a></div></footer></div></div></article></div></main><div class="ml-form-embed" data-account="3117349:p5v1c3m1v8" data-form="4015126:i6h8m5"></div><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:contact@refactorfirst.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/amrutprabhu"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/amrut-prabhu-722baa65/"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/amrutprabhu42"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Amrut Prabhu</div><div> • </div><div>© 2022</div><div> • </div><a href="/">RefactorFirst</a><div> • </div><a href="/privacy">Privacy Policy</a></div><br/></div></footer></div></div><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div id="cookie-notice" class="consent_consentname__aF_O7"><br/><br/><p>By clicking “I Accept”, you agree to the storing of cookies on your device to enhance site navigation and analyze site usage</p><br/><br/><div><a id="cookie-notice-accept" class="consent_greenButton__K0FRN">I Accept</a><a href="/privacy">Privacy Policy</a></div><br/><br/><br/></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var i=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var l=a=\u003ei(a,\"__esModule\",{value:!0});var k=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{l(a);for(var t in s)i(a,t,{get:s[t],enumerable:!0})},y=(a,s,t)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026i(a,n,{get:()=\u003es[n],enumerable:!(t=h(s,n))||t.enumerable});return a},g=a=\u003ey(l(i(a!=null?d(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=k((R,r)=\u003e{r.exports=_jsx_runtime});var C={};N(C,{default:()=\u003ef,frontmatter:()=\u003eb});var e=g(o()),b={title:\"Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Kubernetes\",\"yaml\",\"Docker\"],\"photo-credits\":null,\"applaud-link\":\"2021/spring-boot-stream-kafka.json\",date:\"2022-07-07\",draft:!1,summary:\" In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)\",imageUrl:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",div:\"div\",code:\"code\",ul:\"ul\",li:\"li\",br:\"br\",pre:\"pre\",strong:\"strong\",h3:\"h3\"},a.components),{Image:c}=n;return c||v(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"This is a multi-part article on how you can create a Kubernetes Custom Resource Definition (CRD) and then create a Kubernetes controller to handle CRD instance creation requests. In this article, we would be exploring how we can create your own Kubernetes CRD.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"understanding-how-kubernetes-works-with-resources\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#understanding-how-kubernetes-works-with-resources\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding How Kubernetes Works with Resources\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Before we move on to creating our first CRD and controller, we have to understand some concepts behind how Kubernetes resource management works.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s look at the diagram\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Kubernetes working\",src:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/kubernetes-working.png\",width:\"1187\",height:\"609\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"As you see in the diagram, we have an API server, scheduler, controller, and database. When we use the command \",(0,e.jsx)(n.code,{children:\"kubectl\"}),\" to create a resource, we are actually talking to the API server and the API server merely stores the resource in the database. Now, we have a scheduler, which keeps on asking the API server if there are some resources created.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Once the scheduler finds that a pod has to be created, it then inserts into the database via the API server the reference of the node where the pod will be created.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Next, Kubelets running on the various worker nodes start calling the API server and check if any pods have to be created on that particular node. Kubelets are nothing but controllers themselves.\"}),`\n`,(0,e.jsx)(n.p,{children:\"So in this article, we will see how you can create your own Kubernetes CRD, and then create an instance of the CRD.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"pre-requisites\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#pre-requisites\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Pre-requisites\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"A working Kubernetes cluster. (local or remote)\",(0,e.jsx)(n.br,{}),`\n`,\"If you don't have one, you can always run a \",(0,e.jsx)(n.a,{href:\"https://k3s.io/\",children:\"K3s\"}),\" cluster locally or you can use a Kind Kubernetes cluster. You can read about starting a Kind Kubernetes cluster \",(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/kind-kubernetes-cluster\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsx)(n.li,{children:\"Basic knowledge of working with \\u201CKubectl\\u201D commands to create, get or delete a resource.\"}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"creating-a-kubernetes-custom-resource-definition-crd\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-a-kubernetes-custom-resource-definition-crd\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating a Kubernetes Custom Resource Definition (CRD)\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's create a simple Kubernetes Custom Resource Definition and view its various parts.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apiextensions.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` CustomResourceDefinition\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crds.com.amrut.prabhu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"group\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` com.amrut.prabhu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"names\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"plural\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crds\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"scope\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Namespaced\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"versions\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"served\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"storage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"schema\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"openAPIV3Schema\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"my-own-property\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"This is the most minimalistic definition to create your own Kubernetes CRD.\"}),`\n`,(0,e.jsx)(n.p,{children:\"To understand this, Let\\u2019s break it up into two parts.\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Part 1\"}),\": Define the metadata and definition of the CRD\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Part 2\"}),\": Define the schema of the CRD instances that we will create later.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"understanding-the-kubernetes-custom-resource-definition-format\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#understanding-the-kubernetes-custom-resource-definition-format\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding The Kubernetes Custom Resource Definition Format\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's Look at Part 1.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apiextensions.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` CustomResourceDefinition\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crds.com.amrut.prabhu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"group\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` com.amrut.prabhu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"names\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"plural\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crds\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"scope\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Namespaced\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"versions\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"served\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"storage\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here we define the \\u201CKind\\u201D of our resource, i.e we want to create a CRD and we provide it a name. The name has to be of the format \",(0,e.jsx)(n.code,{children:\"\u003cCRD plural Name\u003e.\u003cGroup name\u003e\"}),\" , ie. \\u201C\",(0,e.jsx)(n.code,{children:\"my-crds\"}),\" \",(0,e.jsx)(n.code,{children:\".\"}),\" \",(0,e.jsx)(n.code,{children:\"com.amrut.prabhu\"}),\" \\u201D. Next, in the \",(0,e.jsx)(n.code,{children:\"spec\"}),\" section, we define the name and the plural name of the kind we are creating. This is the type we will specify while creating a new instance later.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Next, we define that the CRD will be scoped to a namespace and in the version section, we specify the version of this CRD to \",(0,e.jsx)(n.code,{children:\"v1\"}),\". When we want to create a new version of this definition, we will just bump up this version number.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Lastly, we have \",(0,e.jsx)(n.code,{children:\"served\"}),\" property that defines if this CRD is enabled to be used in the cluster and \",(0,e.jsx)(n.code,{children:\"storage\"}),\" refers to if this version of the CRD will be stored. At a time you can have only one version of the CRD that can be stored.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"This was all about defining our CRD. Let\\u2019s look at the schema of the CRD.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"understanding-crd-schema\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#understanding-crd-schema\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding CRD Schema\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"schema\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"openAPIV3Schema\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"my-own-property\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` object\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"In this, we define the schema using the Open API version 3 standards. We specify the top level as an object which has some properties.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now, some of the absolutely required properties are:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"apiVersion\"}),\": To define the version of the CRD we will be using.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"kind\"}),\": The type of the CRD\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"metadata\"}),\": The metadata which will be added such as the name, annotations, etc. This will be of the type Object.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"spec\"}),\": This defines the custom specifications properties you want to provide.\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, in the above schema, I have specified only one property i.e \",(0,e.jsx)(n.code,{children:\"my-own-property\"}),\" in the spec section. You can also define a property of type object having its own properties.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's look at how the CRD is mapped to our CRD instance.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"CRD to CRD instance Mapping\",src:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-to-instance-map.jpg\",width:\"1748\",height:\"1240\"})}),`\n`,(0,e.jsx)(n.p,{children:\"As you can see above, the arrows make it simple to understand which property from the CRD maps to the CRD instance. This is how our custom resource definition is mapped to the actual instance YAML file.\"}),`\n`,(0,e.jsx)(n.p,{children:\"With this, let's first apply our CRD to the Kubernetes cluster.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"adding-kubernetes-crd-to-the-kubernetes-cluster\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#adding-kubernetes-crd-to-the-kubernetes-cluster\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Adding Kubernetes CRD to the Kubernetes Cluster\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In order to use our CRD, We will have to add it to our Kubernetes Cluster. Let\\u2019s install this using the following command\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"language-shell code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`kubectl apply -f my-crd.yaml\n`})})}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"CRD apply\",src:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-apply.png\",width:\"1602\",height:\"548\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Now, after creating the CRD, we are going to create our first CRD instance. We will use the same instance YAML file from above.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` com.amrut.prabhu/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`crd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"custom\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"resource\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`instance\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"my-own-property\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'My first CRD instance'\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"CRD Instance Apply\",src:\"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/crd-instance-apply.png\",width:\"1602\",height:\"388\"})}),`\n`,(0,e.jsx)(n.p,{children:\"With this, we just created our first Kubernetes CRD and then created our first CRD instance.\"}),`\n`,(0,e.jsx)(n.p,{children:\"After creating the instance nothing really happened. Only the instance object was created and stored in the Kubernetes database.\"}),`\n`,(0,e.jsx)(n.p,{children:\"But we want it to do something when we create an instance.\"}),`\n`,(0,e.jsx)(n.p,{children:\"For this, we will need to implement a controller that will handle creating instance requests and do something with it. We will explore this in our next article.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"You can find CRD yaml files on GitHub \",(0,e.jsx)(n.a,{href:\"https://github.com/amrutprabhu/kubernetes-custom-resource/tree/main/crd\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"So, subscribe to my newsletter below and follow me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/amrutprabhu42\",children:\"Twitter\"}),\" to know when the article is published.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Enjoy!!\"})]})}}var f=w;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return C;})();\n;return Component;","toc":[{"value":"Understanding How Kubernetes Works with Resources","url":"#understanding-how-kubernetes-works-with-resources","depth":2},{"value":"Pre-requisites","url":"#pre-requisites","depth":2},{"value":"Creating a Kubernetes Custom Resource Definition (CRD)","url":"#creating-a-kubernetes-custom-resource-definition-crd","depth":2},{"value":"Understanding The Kubernetes Custom Resource Definition Format","url":"#understanding-the-kubernetes-custom-resource-definition-format","depth":2},{"value":"Understanding CRD Schema","url":"#understanding-crd-schema","depth":3},{"value":"Adding Kubernetes CRD to the Kubernetes Cluster","url":"#adding-kubernetes-crd-to-the-kubernetes-cluster","depth":2}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.745,"time":404700,"words":1349},"slug":"2022/create-kubernetes-custom-resource-definition-crd","fileName":"2022/create-kubernetes-custom-resource-definition-crd.md","title":"Part 1: How to Create a Kubernetes Custom Resource Definition (CRD)","author":"Amrut Prabhu","categories":"","tags":["Kubernetes","yaml","Docker"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-07-07T00:00:00.000Z","draft":false,"summary":" In this article, we understand how Kubernetes handles its resources and create our own Kubernetes Custom Resource Definition (CRD)","imageUrl":"/static/images/2022/create-kubernetes-custom-resource-defintion-crd/cover.jpg","actualUrl":"2022/create-kubernetes-custom-resource-definition-crd","customUrl":"create-kubernetes-custom-resource-definition-crd"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.875,"time":52500,"words":175},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"Staff Engineer","company":"Personal","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"https://www.linkedin.com/in/amrut-prabhu-722baa65/","github":"https://github.com/amrutprabhu","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"3 Ways to Create Spring Boot Docker Images Without Docker File","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","Java","Docker","Maven"],"image":"2022/spring-boot-prometheus-grafana/cover.jpg","photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-06-23T00:00:00.000Z","draft":false,"summary":" In this article, we would be looking into some of the ways to create docker images for a Spring Boot Application.","imageUrl":"/static/images/2022/3-ways-to-create-docker-images/cover.jpg","actualUrl":"2022/3-ways-to-create-spring-boot-docker-images","customUrl":"3-ways-to-create-spring-boot-docker-images","slug":"3-ways-to-create-spring-boot-docker-images"},"next":{"title":"Part 2: How to Create a Spring Boot Kubernetes Controller","author":"Amrut Prabhu","categories":"","tags":["Kubernetes","yaml","Docker"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2022-07-21T00:00:00.000Z","draft":false,"summary":" In this article, we learn how to create a Spring Boot based Kubernetes Controller and explore the various components needed to create it.","imageUrl":"/static/images/2022/create-kubernetes-controller-with-spring/cover.jpg","actualUrl":"2022/java-spring-boot-kubernetes-controller","customUrl":"java-spring-boot-kubernetes-controller","slug":"java-spring-boot-kubernetes-controller"}},"__N_SSG":true},"page":"/[slug]","query":{"slug":"create-kubernetes-custom-resource-definition-crd"},"buildId":"ivNckGx43FZiLYbTxZihH","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>